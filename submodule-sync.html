<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Submodule 동기화</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .method-card {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            background: #f8f9fa;
        }
        
        .method-card.recommended {
            border-color: #28a745;
            background: #d4edda;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            font-family: monospace;
            font-size: 13px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }
        
        .pros {
            background: #d4edda;
            padding: 15px;
            border-radius: 6px;
        }
        
        .cons {
            background: #f8d7da;
            padding: 15px;
            border-radius: 6px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px;
        }
        
        .architecture-diagram {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔗 Git Submodule 기반 동기화 전략</h1>
        <p>데이터와 코드를 분리하여 독립적으로 관리하는 고급 Git 동기화 방법</p>
        
        <!-- Submodule 아키텍처 -->
        <div class="method-card recommended">
            <h3>🏗️ Submodule 아키텍처</h3>
            <div class="architecture-diagram">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; align-items: center;">
                    <div style="border: 2px solid #007bff; padding: 15px; border-radius: 8px;">
                        <strong>메인 저장소</strong><br>
                        donation-manager<br>
                        (코드, 오버레이)
                    </div>
                    <div style="font-size: 24px;">⬅️➡️</div>
                    <div style="border: 2px solid #28a745; padding: 15px; border-radius: 8px;">
                        <strong>데이터 저장소</strong><br>
                        donation-data<br>
                        (data.json만)
                    </div>
                </div>
                <div style="margin-top: 15px; color: #6c757d;">
                    데이터는 별도 저장소에서 독립적으로 관리되며,<br>
                    메인 저장소에서 Submodule로 참조
                </div>
            </div>
        </div>
        
        <!-- 방법 1: 데이터 분리 -->
        <div class="method-card">
            <h3>1️⃣ 데이터 저장소 분리</h3>
            <p>data.json을 별도 저장소로 분리하여 독립적으로 관리</p>
            
            <div class="code-block">
                # 1. 데이터 전용 저장소 생성
                mkdir donation-data
                cd donation-data
                git init
                
                # 2. data.json만 이동
                mv ../data.json .
                git add data.json
                git commit -m "Initial data repository"
                
                # 3. GitHub에 푸시
                git remote add origin https://github.com/username/donation-data.git
                git push -u origin main
            </div>
            
            <div class="pros-cons">
                <div class="pros">
                    <h4>✅ 장점</h4>
                    <ul>
                        <li>데이터와 코드 완전 분리</li>
                        <li>독립적인 버전 관리</li>
                        <li>빠른 데이터 업데이트</li>
                        <li>권한 세분화 가능</li>
                    </ul>
                </div>
                <div class="cons">
                    <h4>❌ 단점</h4>
                    <ul>
                        <li>초기 설정 복잡</li>
                        <li>저장소 2개 관리</li>
                        <li>Submodule 이해 필요</li>
                        <li>동기화 과정 추가</li>
                    </ul>
                </div>
            </div>
            
            <button onclick="createDataRepository()">데이터 저장소 생성 가이드</button>
        </div>
        
        <!-- 방법 2: Submodule 연결 -->
        <div class="method-card">
            <h3>2️⃣ Submodule로 데이터 연결</h3>
            <p>메인 저장소에서 데이터 저장소를 Submodule로 연결</p>
            
            <div class="code-block">
                # 메인 저장소에서 실행
                cd donation-manager
                
                # 데이터 저장소를 Submodule로 추가
                git submodule add https://github.com/username/donation-data.git data
                
                # Submodule 초기화
                git submodule init
                git submodule update
                
                # 변경사항 커밋
                git add .gitmodules data
                git commit -m "Add data submodule"
                git push
            </div>
            
            <button onclick="addSubmodule()">Submodule 추가 가이드</button>
            <button onclick="updateSubmodule()">Submodule 업데이트</button>
        </div>
        
        <!-- 방법 3: 자동 동기화 -->
        <div class="method-card">
            <h3>3️⃣ 자동 Submodule 동기화</h3>
            <p>데이터 변경 시 자동으로 Submodule을 업데이트하는 시스템</p>
            
            <div class="code-block">
                # sync-submodule.sh
                #!/bin/bash
                
                echo "Submodule 동기화 시작..."
                
                # 1. 데이터 저장소 업데이트
                cd data
                git add data.json
                git commit -m "자동 데이터 업데이트: $(date)"
                git push origin main
                
                # 2. 메인 저장소에서 Submodule 업데이트
                cd ..
                git submodule update --remote
                git add data
                git commit -m "Submodule 업데이트: 최신 데이터 반영"
                git push origin main
                
                echo "Submodule 동기화 완료!"
            </div>
            
            <button onclick="createSyncScript()">동기화 스크립트 생성</button>
            <button onclick="setupAutoSync()">자동 동기화 설정</button>
        </div>
        
        <!-- 방법 4: GitHub Actions 연동 -->
        <div class="method-card">
            <h3>4️⃣ GitHub Actions 자동 연동</h3>
            <p>데이터 저장소 변경 시 메인 저장소의 Submodule을 자동 업데이트</p>
            
            <div class="code-block">
                # .github/workflows/submodule-sync.yml
                name: Submodule Auto Sync
                
                on:
                  repository_dispatch:
                    types: [data-updated]
                  workflow_dispatch:
                
                jobs:
                  update-submodule:
                    runs-on: ubuntu-latest
                    steps:
                    - uses: actions/checkout@v4
                      with:
                        submodules: true
                        token: ${{ secrets.GITHUB_TOKEN }}
                    
                    - name: Update submodule
                      run: |
                        git submodule update --remote
                        git config --global user.email "action@github.com"
                        git config --global user.name "GitHub Action"
                        git add data
                        git commit -m "Auto-update submodule: latest data" || exit 0
                        git push
            </div>
            
            <button onclick="createActionsWorkflow()">Actions 워크플로 생성</button>
        </div>
        
        <!-- 방법 5: 스마트 동기화 -->
        <div class="method-card recommended">
            <h3>5️⃣ 스마트 Submodule 동기화 (권장)</h3>
            <p>JavaScript에서 직접 Submodule을 관리하는 혁신적인 방법</p>
            
            <div class="code-block">
                // donation-manager.html에서 직접 Submodule 동기화
                async function syncSubmoduleData() {
                    try {
                        // 1. 데이터 저장소에서 최신 데이터 가져오기
                        const dataResponse = await fetch('https://raw.githubusercontent.com/username/donation-data/main/data.json');
                        const newData = await dataResponse.json();
                        
                        // 2. 로컬 데이터와 비교
                        const localData = JSON.parse(localStorage.getItem('donation_data') || '[]');
                        
                        if (JSON.stringify(newData) !== JSON.stringify(localData)) {
                            // 3. 변경사항 감지 시 업데이트
                            updateLocalStorage(newData);
                            
                            // 4. 메인 저장소의 Submodule 참조 업데이트
                            await updateSubmoduleReference();
                            
                            console.log('✅ Submodule 스마트 동기화 완료');
                        }
                        
                    } catch (error) {
                        console.error('Submodule 동기화 실패:', error);
                    }
                }
            </div>
            
            <button onclick="implementSmartSync()">스마트 동기화 구현</button>
            <button onclick="testSubmoduleSync()">동기화 테스트</button>
        </div>
        
        <!-- 비교 분석 -->
        <div class="method-card">
            <h3>📊 Git 동기화 방법 종합 비교</h3>
            
            <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="border: 1px solid #dee2e6; padding: 12px;">방법</th>
                        <th style="border: 1px solid #dee2e6; padding: 12px;">복잡도</th>
                        <th style="border: 1px solid #dee2e6; padding: 12px;">안정성</th>
                        <th style="border: 1px solid #dee2e6; padding: 12px;">속도</th>
                        <th style="border: 1px solid #dee2e6; padding: 12px;">추천도</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="border: 1px solid #dee2e6; padding: 12px;"><strong>Deploy Keys</strong></td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐⭐⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐⭐⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">🏆 최고</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #dee2e6; padding: 12px;"><strong>Tree API</strong></td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">🥈 우수</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #dee2e6; padding: 12px;"><strong>Submodule</strong></td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">🥉 좋음</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #dee2e6; padding: 12px;"><strong>Webhook</strong></td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐⭐⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐⭐⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">🔧 고급</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #dee2e6; padding: 12px;"><strong>Contents API</strong></td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">⭐⭐</td>
                        <td style="border: 1px solid #dee2e6; padding: 12px;">💤 기본</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // 데이터 저장소 생성 가이드
        function createDataRepository() {
            const guide = `
데이터 저장소 생성 단계:

1. GitHub에서 새 저장소 생성
   - 이름: donation-data
   - Public/Private 선택
   - README 체크 해제

2. 로컬에서 데이터 분리
   mkdir donation-data
   cd donation-data
   git init
   
3. 기존 data.json 이동
   cp ../data.json .
   git add data.json
   git commit -m "Initial data repository"
   
4. GitHub 연결
   git remote add origin https://github.com/username/donation-data.git
   git push -u origin main

완료 후 "Submodule 추가 가이드" 버튼을 클릭하세요.
            `;
            
            alert(guide);
        }
        
        // Submodule 추가 가이드
        function addSubmodule() {
            const guide = `
메인 저장소에 Submodule 추가:

1. 메인 저장소 디렉토리에서
   cd donation-manager
   
2. Submodule 추가
   git submodule add https://github.com/username/donation-data.git data
   
3. 초기화
   git submodule init
   git submodule update
   
4. 커밋
   git add .gitmodules data
   git commit -m "Add data submodule"
   git push origin main

이제 data/ 폴더에서 data.json을 독립적으로 관리할 수 있습니다.
            `;
            
            alert(guide);
        }
        
        // Submodule 업데이트
        function updateSubmodule() {
            const updateCommands = `
Submodule 업데이트 명령어:

1. 최신 데이터로 업데이트
   git submodule update --remote
   
2. 특정 Submodule만 업데이트
   git submodule update --remote data
   
3. 변경사항 커밋
   git add data
   git commit -m "Update data submodule"
   git push

자동화하려면 "동기화 스크립트 생성" 버튼을 클릭하세요.
            `;
            
            alert(updateCommands);
        }
        
        // 동기화 스크립트 생성
        function createSyncScript() {
            const script = `#!/bin/bash
# Submodule 자동 동기화 스크립트

echo "🔗 Submodule 동기화 시작..."

# 1. 데이터 저장소에서 변경사항 푸시
echo "📊 데이터 저장소 업데이트 중..."
cd data
git add data.json
git commit -m "자동 데이터 업데이트: $(date '+%Y-%m-%d %H:%M:%S')"
git push origin main

# 2. 메인 저장소로 이동
cd ..

# 3. Submodule 업데이트
echo "🔄 Submodule 업데이트 중..."
git submodule update --remote

# 4. 메인 저장소에서 Submodule 참조 업데이트
git add data
git commit -m "자동 Submodule 업데이트: 최신 데이터 반영"
git push origin main

echo "✅ Submodule 동기화 완료!"
echo "GitHub Pages에서 자동으로 업데이트됩니다."`;
            
            // 스크립트 다운로드
            const blob = new Blob([script], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sync-submodule.sh';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('Submodule 동기화 스크립트가 다운로드되었습니다!\n\n파일: sync-submodule.sh\n사용법: ./sync-submodule.sh');
        }
        
        // 자동 동기화 설정
        function setupAutoSync() {
            const instructions = `
자동 동기화 설정 방법:

1. 스크립트 권한 설정
   chmod +x sync-submodule.sh

2. Cron으로 자동 실행 (예: 5분마다)
   crontab -e
   추가: */5 * * * * /path/to/sync-submodule.sh

3. 또는 Git Hook 사용
   .git/hooks/post-commit에 스크립트 추가

4. Windows에서는 작업 스케줄러 사용
   - 작업 스케줄러 열기
   - 기본 작업 만들기
   - 동작: sync-submodule.bat 실행

이제 데이터 변경 시 자동으로 동기화됩니다!
            `;
            
            alert(instructions);
        }
        
        // GitHub Actions 워크플로 생성
        function createActionsWorkflow() {
            const workflow = `name: Auto Update Submodule

on:
  repository_dispatch:
    types: [data-updated]
  schedule:
    - cron: '*/5 * * * *'  # 5분마다 실행
  workflow_dispatch:

jobs:
  update-submodule:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        submodules: true
        token: \${{ secrets.GITHUB_TOKEN }}
    
    - name: Update submodule
      run: |
        git config --global user.email "action@github.com"
        git config --global user.name "GitHub Action"
        
        # Submodule 업데이트
        git submodule update --remote
        
        # 변경사항이 있는지 확인
        if ! git diff --quiet data; then
          git add data
          git commit -m "자동 Submodule 업데이트: \$(date)"
          git push
          echo "✅ Submodule 업데이트 완료"
        else
          echo "ℹ️ 업데이트할 변경사항 없음"
        fi`;
            
            // 워크플로 다운로드
            const blob = new Blob([workflow], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'submodule-sync.yml';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('GitHub Actions 워크플로가 다운로드되었습니다!\n\n파일: submodule-sync.yml\n위치: .github/workflows/ 폴더에 저장');
        }
        
        // 스마트 동기화 구현
        function implementSmartSync() {
            const smartSyncCode = `
// donation-manager.html에 추가할 스마트 Submodule 동기화 코드

class SubmoduleSync {
    constructor() {
        this.dataRepoUrl = 'https://raw.githubusercontent.com/username/donation-data/main/data.json';
        this.lastSyncTime = localStorage.getItem('last-submodule-sync') || 0;
    }
    
    async checkForUpdates() {
        try {
            // 데이터 저장소에서 최신 데이터 확인
            const response = await fetch(this.dataRepoUrl + '?t=' + Date.now());
            const remoteData = await response.json();
            
            // 로컬 데이터와 비교
            const localDataStr = localStorage.getItem('donation_data');
            const remoteDataStr = JSON.stringify(remoteData.donations || []);
            
            if (localDataStr !== remoteDataStr) {
                console.log('🔄 Submodule 데이터 변경 감지');
                return remoteData;
            }
            
            return null;
        } catch (error) {
            console.error('Submodule 체크 실패:', error);
            return null;
        }
    }
    
    async syncData(newData) {
        // 로컬 스토리지 업데이트
        this.updateLocalStorage(newData);
        
        // 브로드캐스트로 오버레이들에게 알림
        if (window.BroadcastChannel) {
            const channel = new BroadcastChannel('donation-sync');
            channel.postMessage({
                type: 'DATA_UPDATE',
                payload: newData,
                source: 'submodule'
            });
            channel.close();
        }
        
        // 마지막 동기화 시간 업데이트
        localStorage.setItem('last-submodule-sync', Date.now());
        
        console.log('✅ Submodule 스마트 동기화 완료');
    }
    
    updateLocalStorage(data) {
        if (data.donations) {
            localStorage.setItem('donation_data', JSON.stringify(data.donations));
        }
        // ... 다른 데이터도 업데이트
    }
    
    startAutoSync(intervalMs = 30000) {
        setInterval(async () => {
            const newData = await this.checkForUpdates();
            if (newData) {
                await this.syncData(newData);
            }
        }, intervalMs);
        
        console.log('🚀 Submodule 자동 동기화 시작됨');
    }
}

// 사용법
const submoduleSync = new SubmoduleSync();
submoduleSync.startAutoSync(); // 30초마다 체크
            `;
            
            // 코드 다운로드
            const blob = new Blob([smartSyncCode], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'submodule-smart-sync.js';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('스마트 Submodule 동기화 코드가 다운로드되었습니다!\n\n파일: submodule-smart-sync.js\n사용법: donation-manager.html에 코드 추가');
        }
        
        // 동기화 테스트
        function testSubmoduleSync() {
            const testSteps = `
Submodule 동기화 테스트 단계:

1. 데이터 저장소에서 data.json 수정
2. 변경사항 커밋 및 푸시
3. 메인 저장소에서 동기화 스크립트 실행
4. 오버레이에서 변경사항 확인

테스트 명령어:
# 데이터 저장소
cd data
echo '{"test": true}' >> data.json
git add data.json
git commit -m "테스트 데이터 추가"
git push

# 메인 저장소
cd ..
./sync-submodule.sh

성공하면 Submodule 동기화가 완료된 것입니다!
            `;
            
            alert(testSteps);
        }
        
        // 초기화
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Git Submodule 동기화 가이드 로드됨');
        });
    </script>
</body>
</html>