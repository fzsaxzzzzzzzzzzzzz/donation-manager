<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ”§ ì‹¤ì‹œê°„ ì„¤ì • ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</title>

<!-- Socket.IO -->
<script src="/socket.io/socket.io.js"></script>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    margin: 0;
    padding: 20px;
    background: #f5f5f5;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.panel {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.panel h2 {
    margin-top: 0;
    color: #333;
    border-bottom: 2px solid #007bff;
    padding-bottom: 10px;
}

.test-area {
    background: #000;
    color: white;
    padding: 30px;
    margin: 20px 0;
    border-radius: 8px;
    min-height: 150px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.control-group {
    margin: 15px 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.control-group label {
    min-width: 120px;
    font-weight: 600;
}

.control-group input, .control-group select {
    flex: 1;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    margin: 5px;
}

.btn-primary { background: #007bff; color: white; }
.btn-success { background: #28a745; color: white; }
.btn-warning { background: #ffc107; color: #212529; }
.btn-danger { background: #dc3545; color: white; }

.debug-output {
    background: #2d3748;
    color: #e2e8f0;
    padding: 15px;
    border-radius: 5px;
    font-family: monospace;
    font-size: 12px;
    height: 300px;
    overflow-y: auto;
    white-space: pre-wrap;
}

.status {
    padding: 10px;
    border-radius: 5px;
    margin: 10px 0;
    font-weight: 600;
}

.status.success { background: #d4edda; color: #155724; }
.status.error { background: #f8d7da; color: #721c24; }
.status.info { background: #d1ecf1; color: #0c5460; }

#testContent {
    font-size: var(--test-font-size, 18px);
    text-align: var(--test-text-align, left);
    text-shadow: var(--test-text-shadow, 2px 2px 0 #000000);
    font-weight: bold;
    line-height: 1.5;
}
</style>
</head>
<body>

<div class="container">
    <!-- ì„¤ì • ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
    <div class="panel">
        <h2>âš™ï¸ ì„¤ì • ì»¨íŠ¸ë¡¤</h2>
        
        <div class="control-group">
            <label>í°íŠ¸ í¬ê¸°:</label>
            <input type="range" id="fontSize" min="10" max="50" value="18">
            <span id="fontSizeValue">18px</span>
        </div>
        
        <div class="control-group">
            <label>í…ìŠ¤íŠ¸ ì •ë ¬:</label>
            <select id="textAlign">
                <option value="left">ì™¼ìª½ ì •ë ¬</option>
                <option value="center">ê°€ìš´ë° ì •ë ¬</option>
                <option value="right">ì˜¤ë¥¸ìª½ ì •ë ¬</option>
            </select>
        </div>
        
        <div class="control-group">
            <label>í…Œë‘ë¦¬ êµµê¸°:</label>
            <input type="range" id="strokeWidth" min="0" max="10" value="2">
            <span id="strokeWidthValue">2px</span>
        </div>
        
        <div style="margin: 20px 0;">
            <button class="btn btn-primary" onclick="applyLocalSettings()">
                ğŸ”§ ë¡œì»¬ ì ìš© í…ŒìŠ¤íŠ¸
            </button>
            <button class="btn btn-success" onclick="sendToServer()">
                ğŸ“¡ ì„œë²„ë¡œ ì „ì†¡
            </button>
            <button class="btn btn-warning" onclick="loadFromServer()">
                ğŸ“¥ ì„œë²„ì—ì„œ ë¡œë“œ
            </button>
            <button class="btn btn-danger" onclick="clearAll()">
                ğŸ—‘ï¸ ëª¨ë“  ì„¤ì • ì‚­ì œ
            </button>
        </div>
        
        <div id="statusMessage"></div>
        
        <h3>ğŸ’¾ LocalStorage í˜„í™©</h3>
        <div id="localStorageStatus" class="debug-output" style="height: 150px;"></div>
    </div>
    
    <!-- í…ŒìŠ¤íŠ¸ ì˜ì—­ -->
    <div class="panel">
        <h2>ğŸ¨ ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ì˜ì—­</h2>
        
        <div class="test-area">
            <div id="testContent">
                ì‚¬ë‘í•´ìš”â™¡<br>
                í™ê¸¸ë™ë‹˜ 10ë§Œ<br>
                ê¹€ì² ìˆ˜ë‹˜ 5ë§Œ<br>
                ì´ì˜í¬ë‹˜ 3ë§Œ
            </div>
        </div>
        
        <h3>ğŸ” ì ìš©ëœ ìŠ¤íƒ€ì¼ ë¶„ì„</h3>
        <div id="styleAnalysis" class="debug-output" style="height: 200px;"></div>
        
        <h3>ğŸ“¡ ì„œë²„ í†µì‹  ë¡œê·¸</h3>
        <div id="serverLog" class="debug-output" style="height: 150px;"></div>
    </div>
</div>

<script>
let socket = null;
let debugLogs = [];

// Socket.io ì—°ê²°
function initializeConnection() {
    try {
        socket = io();
        
        socket.on('connect', () => {
            log('ì„œë²„ ì—°ê²° ì„±ê³µ', 'success');
        });
        
        socket.on('disconnect', () => {
            log('ì„œë²„ ì—°ê²° ëŠê¹€', 'error');
        });
        
        socket.on('initialData', (data) => {
            log('ì´ˆê¸° ë°ì´í„° ìˆ˜ì‹ : ' + JSON.stringify(data.settings, null, 2), 'info');
        });
        
        socket.on('settingsUpdate', (settings) => {
            log('ì„¤ì • ì—…ë°ì´íŠ¸ ìˆ˜ì‹ : ' + JSON.stringify(settings, null, 2), 'success');
            applyReceivedSettings(settings);
        });
        
    } catch (error) {
        log('Socket ì—°ê²° ì‹¤íŒ¨: ' + error.message, 'error');
    }
}

// ë¡œì»¬ ì„¤ì • ì ìš©
function applyLocalSettings() {
    const fontSize = document.getElementById('fontSize').value;
    const textAlign = document.getElementById('textAlign').value;
    const strokeWidth = document.getElementById('strokeWidth').value;
    
    // localStorageì— ì €ì¥
    localStorage.setItem('overlay-font-size', fontSize);
    localStorage.setItem('overlay-text-align', textAlign);
    localStorage.setItem('overlay-stroke-width', strokeWidth);
    
    // CSS ë³€ìˆ˜ ì ìš©
    const shadow = generateTextShadow(strokeWidth);
    document.documentElement.style.setProperty('--test-font-size', fontSize + 'px');
    document.documentElement.style.setProperty('--test-text-align', textAlign);
    document.documentElement.style.setProperty('--test-text-shadow', shadow);
    
    // ì§ì ‘ ìŠ¤íƒ€ì¼ ì ìš©
    const testEl = document.getElementById('testContent');
    testEl.style.cssText = `
        font-size: ${fontSize}px !important;
        text-align: ${textAlign} !important;
        text-shadow: ${shadow} !important;
        font-weight: bold !important;
        color: white !important;
        line-height: 1.5 !important;
    `;
    
    log('ë¡œì»¬ ì„¤ì • ì ìš©: ' + JSON.stringify({fontSize, textAlign, strokeWidth}), 'success');
    updateLocalStorageDisplay();
    analyzeAppliedStyles();
}

// ì„œë²„ë¡œ ì„¤ì • ì „ì†¡
async function sendToServer() {
    try {
        const settings = {
            'overlay-font-size': document.getElementById('fontSize').value,
            'overlay-text-align': document.getElementById('textAlign').value,
            'overlay-stroke-width': document.getElementById('strokeWidth').value
        };
        
        log('ì„œë²„ë¡œ ì„¤ì • ì „ì†¡ ì¤‘: ' + JSON.stringify(settings), 'info');
        
        const response = await fetch('/api/settings', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ settings })
        });
        
        const result = await response.json();
        
        if (result.success) {
            log('ì„œë²„ ì „ì†¡ ì„±ê³µ: ' + JSON.stringify(result), 'success');
            showStatus('ì„œë²„ë¡œ ì„¤ì • ì „ì†¡ ì™„ë£Œ!', 'success');
        } else {
            log('ì„œë²„ ì „ì†¡ ì‹¤íŒ¨: ' + JSON.stringify(result), 'error');
            showStatus('ì„œë²„ ì „ì†¡ ì‹¤íŒ¨: ' + result.error, 'error');
        }
        
    } catch (error) {
        log('ì„œë²„ ì „ì†¡ ì˜¤ë¥˜: ' + error.message, 'error');
        showStatus('ì„œë²„ í†µì‹  ì˜¤ë¥˜: ' + error.message, 'error');
    }
}

// ì„œë²„ì—ì„œ ì„¤ì • ë¡œë“œ
async function loadFromServer() {
    try {
        log('ì„œë²„ì—ì„œ ì„¤ì • ë¡œë“œ ì¤‘...', 'info');
        
        const response = await fetch('/api/data');
        const data = await response.json();
        
        log('ì„œë²„ ë°ì´í„° ìˆ˜ì‹ : ' + JSON.stringify(data.settings, null, 2), 'info');
        
        if (data.settings) {
            applyReceivedSettings(data.settings);
            showStatus('ì„œë²„ ì„¤ì • ë¡œë“œ ì™„ë£Œ!', 'success');
        } else {
            showStatus('ì„œë²„ì— ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
        }
        
    } catch (error) {
        log('ì„œë²„ ë¡œë“œ ì˜¤ë¥˜: ' + error.message, 'error');
        showStatus('ì„œë²„ ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
    }
}

// ìˆ˜ì‹ ëœ ì„¤ì • ì ìš©
function applyReceivedSettings(settings) {
    if (settings['overlay-font-size']) {
        document.getElementById('fontSize').value = settings['overlay-font-size'];
        document.getElementById('fontSizeValue').textContent = settings['overlay-font-size'] + 'px';
    }
    
    if (settings['overlay-text-align']) {
        document.getElementById('textAlign').value = settings['overlay-text-align'];
    }
    
    if (settings['overlay-stroke-width']) {
        document.getElementById('strokeWidth').value = settings['overlay-stroke-width'];
        document.getElementById('strokeWidthValue').textContent = settings['overlay-stroke-width'] + 'px';
    }
    
    applyLocalSettings();
    log('ìˆ˜ì‹ ëœ ì„¤ì • ì ìš© ì™„ë£Œ', 'success');
}

// ëª¨ë“  ì„¤ì • ì‚­ì œ
function clearAll() {
    localStorage.clear();
    document.getElementById('fontSize').value = 18;
    document.getElementById('textAlign').value = 'left';
    document.getElementById('strokeWidth').value = 2;
    
    const testEl = document.getElementById('testContent');
    testEl.style.cssText = '';
    
    updateLocalStorageDisplay();
    analyzeAppliedStyles();
    log('ëª¨ë“  ì„¤ì • ì‚­ì œ ì™„ë£Œ', 'info');
    showStatus('ëª¨ë“  ì„¤ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
}

// í…ìŠ¤íŠ¸ ì„€ë„ìš° ìƒì„±
function generateTextShadow(width) {
    const w = parseInt(width);
    return `${w}px ${w}px 0 #000000, -${w}px -${w}px 0 #000000, ${w}px -${w}px 0 #000000, -${w}px ${w}px 0 #000000, ${w}px 0px 0 #000000, -${w}px 0px 0 #000000, 0px ${w}px 0 #000000, 0px -${w}px 0 #000000`;
}

// ë¡œê·¸ ì¶œë ¥
function log(message, type = 'info') {
    const timestamp = new Date().toLocaleTimeString();
    debugLogs.push(`[${timestamp}] ${message}`);
    
    const serverLog = document.getElementById('serverLog');
    serverLog.textContent = debugLogs.slice(-20).join('\n');
    serverLog.scrollTop = serverLog.scrollHeight;
}

// ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
function showStatus(message, type) {
    const statusEl = document.getElementById('statusMessage');
    statusEl.textContent = message;
    statusEl.className = 'status ' + type;
    
    setTimeout(() => {
        statusEl.textContent = '';
        statusEl.className = '';
    }, 3000);
}

// localStorage ìƒíƒœ ì—…ë°ì´íŠ¸
function updateLocalStorageDisplay() {
    const storageEl = document.getElementById('localStorageStatus');
    const relevantKeys = [
        'overlay-font-size', 'overlay-text-align', 'overlay-stroke-width',
        'table-opacity', 'table-font-size', 'table-text-color'
    ];
    
    let output = 'localStorage ë‚´ìš©:\n';
    relevantKeys.forEach(key => {
        const value = localStorage.getItem(key);
        output += `  ${key}: ${value || '(ì—†ìŒ)'}\n`;
    });
    
    output += '\nëª¨ë“  localStorage í•­ëª©:\n';
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const value = localStorage.getItem(key);
        output += `  ${key}: ${value}\n`;
    }
    
    storageEl.textContent = output;
}

// ì ìš©ëœ ìŠ¤íƒ€ì¼ ë¶„ì„
function analyzeAppliedStyles() {
    const testEl = document.getElementById('testContent');
    const computed = window.getComputedStyle(testEl);
    
    const analysis = `ì ìš©ëœ ìŠ¤íƒ€ì¼ ë¶„ì„:
  fontSize: ${computed.fontSize}
  textAlign: ${computed.textAlign}
  textShadow: ${computed.textShadow}
  fontWeight: ${computed.fontWeight}
  color: ${computed.color}
  lineHeight: ${computed.lineHeight}
  
CSS ë³€ìˆ˜:
  --test-font-size: ${getComputedStyle(document.documentElement).getPropertyValue('--test-font-size')}
  --test-text-align: ${getComputedStyle(document.documentElement).getPropertyValue('--test-text-align')}
  --test-text-shadow: ${getComputedStyle(document.documentElement).getPropertyValue('--test-text-shadow')}
  
inline style:
  ${testEl.style.cssText}`;
    
    document.getElementById('styleAnalysis').textContent = analysis;
}

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
document.addEventListener('DOMContentLoaded', () => {
    initializeConnection();
    
    // ìŠ¬ë¼ì´ë” ê°’ ì—…ë°ì´íŠ¸
    document.getElementById('fontSize').addEventListener('input', (e) => {
        document.getElementById('fontSizeValue').textContent = e.target.value + 'px';
    });
    
    document.getElementById('strokeWidth').addEventListener('input', (e) => {
        document.getElementById('strokeWidthValue').textContent = e.target.value + 'px';
    });
    
    // ì´ˆê¸° ìƒíƒœ ì—…ë°ì´íŠ¸
    updateLocalStorageDisplay();
    analyzeAppliedStyles();
    
    // 1ì´ˆë§ˆë‹¤ ìƒíƒœ ì—…ë°ì´íŠ¸
    setInterval(() => {
        updateLocalStorageDisplay();
        analyzeAppliedStyles();
    }, 1000);
});
</script>

</body>
</html>