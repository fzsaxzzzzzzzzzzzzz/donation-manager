<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>후원 관리 시스템</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
.container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
.section { margin-bottom: 30px; padding: 20px; border: 2px solid #007bff; border-radius: 8px; background: #f8f9ff; }
.section h2 { margin: 0 0 20px 0; color: #007bff; }
.form-row { display: grid; grid-template-columns: 1fr 2fr 1fr 1fr auto; gap: 15px; align-items: center; margin-bottom: 15px; }
.form-group { margin-bottom: 15px; }
.form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
.form-input { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 14px; }
.form-input:focus { border-color: #007bff; outline: none; }
.btn { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
.btn:hover { background: #0056b3; }
.btn-success { background: #28a745; }
.btn-success:hover { background: #1e7e34; }
.streamer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
.streamer-item { margin-bottom: 10px; }
.streamer-item label { display: block; margin-bottom: 5px; font-weight: bold; color: #17a2b8; font-size: 13px; }
.status { padding: 10px; border-radius: 5px; margin: 10px 0; font-weight: bold; }
.status-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.status-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.table { width: 100%; border-collapse: collapse; margin-top: 20px; }
.table th, .table td { border: 1px solid #ddd; padding: 8px; text-align: center; }
.table th { background: #f8f9fa; font-weight: bold; }
.editable { cursor: pointer; background: #f8f9fa; }
.editable:hover { background: #e9ecef; }
</style>
</head>
<body>

<div class="container">
    <h1>🎯 후원 관리 시스템</h1>
    
    <!-- 빠른 후원 등록 -->
    <div class="section">
        <h2>⚡ 빠른 후원 등록</h2>
        <div class="form-row">
            <div>
                <label>후원자명</label>
                <input type="text" id="quick-donor" class="form-input" placeholder="후원자명 입력">
            </div>
            <div>
                <label>스트리머</label>
                <select id="quick-streamer" class="form-input">
                    <option value="엄삼용">🫅 엄삼용</option>
                    <option value="손덕배">🌺 손덕배</option>
                    <option value="연기">🐧 연기</option>
                    <option value="주옥">👺 주옥</option>
                    <option value="불곰">🎬 불곰</option>
                    <option value="이효팔">🏝 이효팔</option>
                    <option value="동동">😎 동동</option>
                    <option value="남붕">🤠 남붕</option>
                    <option value="옥긔">🦆 옥긔</option>
                    <option value="국고">🏦 국고</option>
                </select>
            </div>
            <div>
                <label>금액(만원)</label>
                <input type="text" id="quick-amount" class="form-input" placeholder="0" inputmode="numeric">
            </div>
            <div>
                <label>타입</label>
                <select id="quick-type" class="form-input">
                    <option value="계좌">💳 계좌</option>
                    <option value="투네">🎯 투네</option>
                    <option value="슈퍼챗">💬 슈퍼챗</option>
                </select>
            </div>
            <div>
                <button onclick="quickAdd()" class="btn">➕ 등록</button>
            </div>
        </div>
    </div>

    <!-- 일괄 후원 등록 -->
    <div class="section">
        <h2>📊 일괄 후원 등록</h2>
        <div class="form-group">
            <label>후원자명</label>
            <input type="text" id="batch-donor" class="form-input" placeholder="후원자명 입력">
        </div>
        <div class="form-group">
            <label>후원 타입</label>
            <div style="display: flex; gap: 20px;">
                <label><input type="radio" name="batch-type" value="계좌" checked> 💳 계좌</label>
                <label><input type="radio" name="batch-type" value="투네"> 🎯 투네</label>
                <label><input type="radio" name="batch-type" value="슈퍼챗"> 💬 슈퍼챗</label>
            </div>
        </div>
        <div class="form-group">
            <label>스트리머별 금액(만원)</label>
            <div class="streamer-grid">
                <div class="streamer-item">
                    <label>🫅 엄삼용</label>
                    <input type="text" data-streamer="엄삼용" class="form-input streamer-amount" placeholder="0" inputmode="numeric">
                </div>
                <div class="streamer-item">
                    <label>🌺 손덕배</label>
                    <input type="text" data-streamer="손덕배" class="form-input streamer-amount" placeholder="0" inputmode="numeric">
                </div>
                <div class="streamer-item">
                    <label>🐧 연기</label>
                    <input type="text" data-streamer="연기" class="form-input streamer-amount" placeholder="0" inputmode="numeric">
                </div>
                <div class="streamer-item">
                    <label>👺 주옥</label>
                    <input type="text" data-streamer="주옥" class="form-input streamer-amount" placeholder="0" inputmode="numeric">
                </div>
                <div class="streamer-item">
                    <label>🎬 불곰</label>
                    <input type="text" data-streamer="불곰" class="form-input streamer-amount" placeholder="0" inputmode="numeric">
                </div>
                <div class="streamer-item">
                    <label>🏝 이효팔</label>
                    <input type="text" data-streamer="이효팔" class="form-input streamer-amount" placeholder="0" inputmode="numeric">
                </div>
                <div class="streamer-item">
                    <label>😎 동동</label>
                    <input type="text" data-streamer="동동" class="form-input streamer-amount" placeholder="0" inputmode="numeric">
                </div>
                <div class="streamer-item">
                    <label>🤠 남붕</label>
                    <input type="text" data-streamer="남붕" class="form-input streamer-amount" placeholder="0" inputmode="numeric">
                </div>
                <div class="streamer-item">
                    <label>🦆 옥긔</label>
                    <input type="text" data-streamer="옥긔" class="form-input streamer-amount" placeholder="0" inputmode="numeric">
                </div>
                <div class="streamer-item">
                    <label>🏦 국고</label>
                    <input type="text" data-streamer="국고" class="form-input streamer-amount" placeholder="0" inputmode="numeric">
                </div>
            </div>
        </div>
        <button onclick="batchAdd()" class="btn btn-success" style="width: 100%; padding: 15px; font-size: 16px;">✨ 일괄 등록</button>
    </div>

    <!-- 상태 메시지 -->
    <div id="status-message"></div>

    <!-- 후원 내역 테이블 -->
    <div class="section">
        <h2>📋 후원 내역</h2>
        <button onclick="loadData()" class="btn" style="margin-bottom: 15px;">🔄 새로고침</button>
        <table class="table">
            <thead>
                <tr>
                    <th>번호</th>
                    <th>후원자</th>
                    <th>스트리머</th>
                    <th>타입</th>
                    <th>금액(만)</th>
                    <th>시간</th>
                    <th>삭제</th>
                </tr>
            </thead>
            <tbody id="donation-table">
                <tr>
                    <td colspan="7">후원 내역이 없습니다.</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
// 전역 변수
let donations = [];
let socket = null;

// 상태 메시지 표시
function showStatus(message, type = 'info') {
    const statusEl = document.getElementById('status-message');
    statusEl.className = `status status-${type}`;
    statusEl.textContent = message;
    setTimeout(() => statusEl.textContent = '', 3000);
}

// 숫자만 입력 허용
function onlyNumbers(event) {
    const char = String.fromCharCode(event.which);
    if (!/[0-9.]/.test(char)) {
        event.preventDefault();
    }
}

// 빠른 등록
function quickAdd() {
    const donor = document.getElementById('quick-donor').value.trim();
    const streamer = document.getElementById('quick-streamer').value;
    const amount = parseFloat(document.getElementById('quick-amount').value);
    const type = document.getElementById('quick-type').value;

    if (!donor) {
        showStatus('후원자명을 입력하세요.', 'error');
        return;
    }
    if (!amount || amount <= 0) {
        showStatus('올바른 금액을 입력하세요.', 'error');
        return;
    }

    const donation = {
        id: Date.now(),
        donor: donor,
        streamer: streamer,
        type: type,
        amount: amount,
        time: new Date()
    };

    donations.unshift(donation);
    document.getElementById('quick-donor').value = '';
    document.getElementById('quick-amount').value = '';
    updateTable();
    showStatus(`${donor}님 → ${streamer} ${amount}만원 등록완료!`, 'success');
}

// 일괄 등록
function batchAdd() {
    const donor = document.getElementById('batch-donor').value.trim();
    const type = document.querySelector('input[name="batch-type"]:checked').value;

    if (!donor) {
        showStatus('후원자명을 입력하세요.', 'error');
        return;
    }

    const streamerInputs = document.querySelectorAll('.streamer-amount');
    const newDonations = [];

    streamerInputs.forEach(input => {
        const amount = parseFloat(input.value.trim());
        if (!isNaN(amount) && amount > 0) {
            const streamer = input.dataset.streamer;
            newDonations.push({
                id: Date.now() + Math.random(),
                donor: donor,
                streamer: streamer,
                type: type,
                amount: amount,
                time: new Date()
            });
        }
    });

    if (newDonations.length === 0) {
        showStatus('최소 하나의 스트리머에게 금액을 입력하세요.', 'error');
        return;
    }

    donations.unshift(...newDonations);
    document.getElementById('batch-donor').value = '';
    streamerInputs.forEach(input => input.value = '');
    updateTable();
    showStatus(`${newDonations.length}개 후원이 등록되었습니다!`, 'success');
}

// 테이블 업데이트
function updateTable() {
    const tbody = document.getElementById('donation-table');
    
    if (donations.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7">후원 내역이 없습니다.</td></tr>';
        return;
    }

    tbody.innerHTML = donations.map((d, index) => `
        <tr>
            <td>${index + 1}</td>
            <td class="editable" onclick="editCell(this, ${index}, 'donor')">${d.donor}</td>
            <td class="editable" onclick="editCell(this, ${index}, 'streamer')">${d.streamer}</td>
            <td class="editable" onclick="editCell(this, ${index}, 'type')">${d.type}</td>
            <td class="editable" onclick="editCell(this, ${index}, 'amount')">${d.amount}</td>
            <td>${d.time.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}</td>
            <td><button onclick="deleteDonation(${index})" class="btn" style="background: #dc3545; padding: 5px 10px;">삭제</button></td>
        </tr>
    `).join('');
}

// 셀 편집
function editCell(cell, index, field) {
    const currentValue = donations[index][field];
    const newValue = prompt(`${field} 수정:`, currentValue);
    
    if (newValue !== null && newValue.trim() !== '') {
        if (field === 'amount') {
            const amount = parseFloat(newValue);
            if (isNaN(amount) || amount <= 0) {
                showStatus('올바른 금액을 입력하세요.', 'error');
                return;
            }
            donations[index][field] = amount;
        } else {
            donations[index][field] = newValue.trim();
        }
        updateTable();
        showStatus('수정이 완료되었습니다.', 'success');
    }
}

// 후원 삭제
function deleteDonation(index) {
    if (confirm('이 후원을 삭제하시겠습니까?')) {
        donations.splice(index, 1);
        updateTable();
        showStatus('후원이 삭제되었습니다.', 'success');
    }
}

// 데이터 로드
function loadData() {
    updateTable();
    showStatus('데이터를 새로고침했습니다.', 'success');
}

// 숫자 입력 필드에 이벤트 리스너 추가
document.addEventListener('DOMContentLoaded', function() {
    const numericInputs = document.querySelectorAll('input[inputmode="numeric"]');
    numericInputs.forEach(input => {
        input.addEventListener('keypress', onlyNumbers);
    });
});

console.log('새로운 후원 관리 시스템이 시작되었습니다.');
</script>

</body>
</html>