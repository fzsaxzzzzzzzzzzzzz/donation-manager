<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¬ ì‹¤ì‹œê°„ í›„ì› ì‹œìŠ¤í…œ - í†µí•© ê´€ë¦¬</title>

<!-- Socket.IO -->
<script src="/socket.io/socket.io.js"></script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #f5f6fa;
    color: #2c3e50;
    line-height: 1.6;
}

.header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.header h1 {
    font-size: 2rem;
    margin-bottom: 10px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.tabs-container {
    background: white;
    border-bottom: 3px solid #e9ecef;
    padding: 0 20px;
    overflow-x: auto;
    white-space: nowrap;
}

.tabs {
    display: flex;
    gap: 0;
    min-width: max-content;
}

.tab {
    padding: 15px 20px;
    background: none;
    border: none;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    color: #6c757d;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.tab:hover {
    color: #495057;
    background: #f8f9fa;
}

.tab.active {
    color: #667eea;
    border-bottom-color: #667eea;
    background: #f8f9ff;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.tab-content {
    display: none;
    animation: fadeIn 0.3s ease-in-out;
}

.tab-content.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.grid {
    display: grid;
    gap: 20px;
    margin-bottom: 30px;
}

.grid-2 { grid-template-columns: 1fr 1fr; }
.grid-3 { grid-template-columns: repeat(3, 1fr); }
.grid-4 { grid-template-columns: repeat(4, 1fr); }

@media (max-width: 768px) {
    .grid-2, .grid-3, .grid-4 {
        grid-template-columns: 1fr;
    }
}

.card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    border: 1px solid #e9ecef;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.12);
}

.card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f8f9fa;
}

.card-header h3 {
    font-size: 1.3rem;
    color: #2c3e50;
    margin: 0;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    font-weight: 600;
    color: #495057;
    margin-bottom: 8px;
    font-size: 0.9rem;
}

.form-input, .form-select {
    width: 100%;
    padding: 12px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.form-input:focus, .form-select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-range {
    width: 100%;
    margin: 10px 0;
}

.range-display {
    display: flex;
    align-items: center;
    gap: 10px;
}

.range-value {
    min-width: 50px;
    padding: 4px 8px;
    background: #e9ecef;
    border-radius: 4px;
    font-weight: 600;
    text-align: center;
    font-size: 0.85rem;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    justify-content: center;
}

.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.btn-primary { background: #667eea; color: white; }
.btn-success { background: #2ed573; color: white; }
.btn-warning { background: #ffa502; color: white; }
.btn-danger { background: #ff4757; color: white; }
.btn-info { background: #3742fa; color: white; }
.btn-secondary { background: #57606f; color: white; }

.btn-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 15px;
}

.status-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 20px;
}

.status-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.status-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.status-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
.status-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }

.connection-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #2ed573;
    animation: pulse 2s infinite;
}

.connection-dot.disconnected {
    background: #ff4757;
    animation: none;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}

/* ì˜¤ë²„ë ˆì´ ë¯¸ë¦¬ë³´ê¸° */
.overlay-preview {
    background: #000;
    color: white;
    padding: 30px;
    border-radius: 12px;
    min-height: 150px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    text-shadow: 3px 3px 0 #000000, -3px -3px 0 #000000, 3px -3px 0 #000000, -3px 3px 0 #000000;
    margin: 20px 0;
    transition: all 0.3s ease;
}

.overlay-preview-text {
    font-size: 24px;
    text-align: center;
    line-height: 1.5;
    white-space: pre-line;
}

/* ë¡œê·¸ ì¶œë ¥ */
.log-output {
    background: #2d3748;
    color: #e2e8f0;
    padding: 15px;
    border-radius: 8px;
    font-family: monospace;
    font-size: 12px;
    height: 200px;
    overflow-y: auto;
    white-space: pre-wrap;
    border: 1px solid #4a5568;
}

/* í›„ì› ë¦¬ìŠ¤íŠ¸ */
.donation-list {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #e9ecef;
    border-radius: 8px;
}

.donation-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    border-bottom: 1px solid #f8f9fa;
    transition: background-color 0.2s ease;
}

.donation-item:hover {
    background: #f8f9fa;
}

.donation-item:last-child {
    border-bottom: none;
}

.donation-info {
    flex: 1;
}

.donation-donor {
    font-weight: 600;
    color: #2c3e50;
}

.donation-details {
    font-size: 0.9rem;
    color: #6c757d;
    margin-top: 5px;
}

.donation-amount {
    font-weight: 700;
    font-size: 1.1rem;
    color: #2ed573;
}

/* ë°˜ì‘í˜• */
@media (max-width: 768px) {
    .container {
        padding: 10px;
    }
    
    .card {
        padding: 20px;
    }
    
    .btn-group {
        flex-direction: column;
    }
    
    .tabs {
        flex-wrap: wrap;
    }
    
    .tab {
        flex: 1;
        min-width: 120px;
    }
}

/* ì•Œë¦¼ ë©”ì‹œì§€ */
.alert {
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
    font-weight: 600;
    display: none;
}

.alert.show {
    display: block;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.floating-overlay-controls {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: white;
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    border: 1px solid #e9ecef;
    z-index: 999;
    display: none;
}

.floating-overlay-controls.show {
    display: block;
}
</style>
</head>
<body>

<div class="header">
    <h1>ğŸ¬ ì‹¤ì‹œê°„ í›„ì› ì‹œìŠ¤í…œ</h1>
    <div class="status-indicator status-info" id="connectionStatus">
        <div class="connection-dot" id="connectionDot"></div>
        <span id="connectionText">ì—°ê²° ì¤‘...</span>
    </div>
</div>

<div class="tabs-container">
    <div class="tabs">
        <button class="tab active" onclick="showTab('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
        <button class="tab" onclick="showTab('donations')">ğŸ’° í›„ì› ê´€ë¦¬</button>
        <button class="tab" onclick="showTab('streamers')">ğŸ‘¥ ìŠ¤íŠ¸ë¦¬ë¨¸ ê´€ë¦¬</button>
        <button class="tab" onclick="showTab('settings')">âš™ï¸ ì„¤ì •</button>
        <button class="tab" onclick="showTab('overlays')">ğŸ¥ ì˜¤ë²„ë ˆì´</button>
        <button class="tab" onclick="showTab('debug')">ğŸ”§ ë””ë²„ê·¸</button>
    </div>
</div>

<div class="container">
    <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
    <div id="dashboard" class="tab-content active">
        <div class="grid grid-3">
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ“Š í†µê³„</h3>
                </div>
                <div id="stats">
                    <p><strong>ì´ í›„ì›:</strong> <span id="totalAmount">0</span>ë§Œì›</p>
                    <p><strong>í›„ì› ê±´ìˆ˜:</strong> <span id="totalCount">0</span>ê±´</p>
                    <p><strong>ì—°ê²° ì‚¬ìš©ì:</strong> <span id="connectedUsers">0</span>ëª…</p>
                    <p><strong>í™œì„± ìŠ¤íŠ¸ë¦¬ë¨¸:</strong> <span id="activeStreamers">0</span>ëª…</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>ğŸ”¥ ì‹¤ì‹œê°„ ì˜¤ë²„ë ˆì´ ë¯¸ë¦¬ë³´ê¸°</h3>
                </div>
                <div class="overlay-preview" id="overlayPreview">
                    <div class="overlay-preview-text" id="overlayPreviewText">
                        ì‚¬ë‘í•´ìš”â™¡<br>ë°ì´í„° ë¡œë”© ì¤‘...
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="openOverlay('donor-overlay-simple.html')">ğŸ¥ ì˜¤ë²„ë ˆì´ ì—´ê¸°</button>
                    <button class="btn btn-info" onclick="testOverlaySettings()">ğŸ§ª ì„¤ì • í…ŒìŠ¤íŠ¸</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>âš¡ ë¹ ë¥¸ ì‘ì—…</h3>
                </div>
                <div class="btn-group" style="flex-direction: column;">
                    <button class="btn btn-success" onclick="showTab('donations'); document.getElementById('newDonationForm').scrollIntoView();">ğŸ’° í›„ì› ì¶”ê°€</button>
                    <button class="btn btn-info" onclick="showTab('streamers'); document.getElementById('addStreamerForm').scrollIntoView();">ğŸ‘¥ ìŠ¤íŠ¸ë¦¬ë¨¸ ì¶”ê°€</button>
                    <button class="btn btn-warning" onclick="showTab('settings');">âš™ï¸ ì„¤ì • ë³€ê²½</button>
                    <button class="btn btn-danger" onclick="fixSettings();">ğŸ”§ ì„¤ì • ìˆ˜ì •</button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>ğŸ“ˆ ìµœê·¼ í›„ì› í˜„í™©</h3>
            </div>
            <div id="recentDonations" class="donation-list">
                <div class="donation-item">
                    <div class="donation-info">
                        <div class="donation-donor">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                        <div class="donation-details">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í›„ì› ê´€ë¦¬ íƒ­ -->
    <div id="donations" class="tab-content">
        <div class="grid grid-2">
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ’° ìƒˆ í›„ì› ì¶”ê°€</h3>
                </div>
                <form id="newDonationForm">
                    <div class="form-group">
                        <label class="form-label">í›„ì›ìëª…</label>
                        <input type="text" id="donorName" class="form-input" placeholder="í›„ì›ì ì´ë¦„">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ìŠ¤íŠ¸ë¦¬ë¨¸</label>
                        <select id="streamerSelect" class="form-select">
                            <option value="">ìŠ¤íŠ¸ë¦¬ë¨¸ ì„ íƒ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">í›„ì› ë°©ì‹</label>
                        <select id="donationType" class="form-select">
                            <option value="ê³„ì¢Œ">ê³„ì¢Œ ì´ì²´</option>
                            <option value="íˆ¬ë„¤ì´ì…˜">íˆ¬ë„¤ì´ì…˜</option>
                            <option value="í›„ì›">ê¸°íƒ€ í›„ì›</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">í›„ì› ê¸ˆì•¡ (ë§Œì›)</label>
                        <input type="number" id="donationAmount" class="form-input" placeholder="0" step="0.1" min="0">
                    </div>
                    <button type="submit" class="btn btn-success" style="width: 100%;">ğŸ’° í›„ì› ì¶”ê°€</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>ğŸ“‹ í›„ì› ëª©ë¡</h3>
                </div>
                <div id="donationsList" class="donation-list">
                    <!-- í›„ì› ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ìŠ¤íŠ¸ë¦¬ë¨¸ ê´€ë¦¬ íƒ­ -->
    <div id="streamers" class="tab-content">
        <div class="grid grid-2">
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ‘¥ ìƒˆ ìŠ¤íŠ¸ë¦¬ë¨¸ ì¶”ê°€</h3>
                </div>
                <form id="addStreamerForm">
                    <div class="form-group">
                        <label class="form-label">ìŠ¤íŠ¸ë¦¬ë¨¸ ì´ë¦„</label>
                        <input type="text" id="newStreamerName" class="form-input" placeholder="ìŠ¤íŠ¸ë¦¬ë¨¸ ì´ë¦„">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì´ëª¨ì§€</label>
                        <input type="text" id="newStreamerEmoji" class="form-input" placeholder="ğŸ®" maxlength="4">
                    </div>
                    <button type="submit" class="btn btn-success" style="width: 100%;">ğŸ‘¥ ìŠ¤íŠ¸ë¦¬ë¨¸ ì¶”ê°€</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>ğŸ‘¥ ìŠ¤íŠ¸ë¦¬ë¨¸ ëª©ë¡</h3>
                </div>
                <div id="streamersList">
                    <!-- ìŠ¤íŠ¸ë¦¬ë¨¸ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ì„¤ì • íƒ­ -->
    <div id="settings" class="tab-content">
        <div class="grid grid-2">
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ¨ ì˜¤ë²„ë ˆì´ ì„¤ì •</h3>
                </div>
                
                <div class="form-group">
                    <label class="form-label">í°íŠ¸ í¬ê¸°</label>
                    <div class="range-display">
                        <input type="range" id="overlayFontSize" class="form-range" min="10" max="50" value="24">
                        <span class="range-value" id="overlayFontSizeValue">24px</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">í…ìŠ¤íŠ¸ ì •ë ¬</label>
                    <select id="overlayTextAlign" class="form-select">
                        <option value="left">ì™¼ìª½ ì •ë ¬</option>
                        <option value="center">ê°€ìš´ë° ì •ë ¬</option>
                        <option value="right">ì˜¤ë¥¸ìª½ ì •ë ¬</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">í…ìŠ¤íŠ¸ í…Œë‘ë¦¬ êµµê¸°</label>
                    <div class="range-display">
                        <input type="range" id="overlayStrokeWidth" class="form-range" min="0" max="10" value="3">
                        <span class="range-value" id="overlayStrokeWidthValue">3px</span>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="applyOverlaySettings()">ğŸ’¾ ì„¤ì • ì ìš©</button>
                    <button class="btn btn-warning" onclick="resetOverlaySettings()">ğŸ”„ ê¸°ë³¸ê°’ ë³µì›</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>ğŸ“Š í…Œì´ë¸” ì„¤ì •</h3>
                </div>

                <div class="form-group">
                    <label class="form-label">í…Œì´ë¸” íˆ¬ëª…ë„</label>
                    <div class="range-display">
                        <input type="range" id="tableOpacity" class="form-range" min="0" max="100" value="85">
                        <span class="range-value" id="tableOpacityValue">85%</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">í…Œì´ë¸” í°íŠ¸ í¬ê¸°</label>
                    <div class="range-display">
                        <input type="range" id="tableFontSize" class="form-range" min="8" max="24" value="14">
                        <span class="range-value" id="tableFontSizeValue">14px</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">í…ìŠ¤íŠ¸ ìƒ‰ìƒ</label>
                    <input type="color" id="tableTextColor" class="form-input" value="#ffffff">
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="applyTableSettings()">ğŸ’¾ í…Œì´ë¸” ì„¤ì • ì ìš©</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì˜¤ë²„ë ˆì´ íƒ­ -->
    <div id="overlays" class="tab-content">
        <div class="grid grid-3">
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ¥ í›„ì›ì ì˜¤ë²„ë ˆì´</h3>
                </div>
                <p>ì‹¤ì‹œê°„ í›„ì›ìë³„ ì´ì•¡ì„ í‘œì‹œí•˜ëŠ” ì˜¤ë²„ë ˆì´ì…ë‹ˆë‹¤.</p>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="openOverlay('donor-overlay-simple.html')">ğŸ¥ Simple ì˜¤ë²„ë ˆì´</button>
                    <button class="btn btn-secondary" onclick="openOverlay('donor-overlay.html')">ğŸ¥ ê³ ê¸‰ ì˜¤ë²„ë ˆì´</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>ğŸ“Š í…Œì´ë¸” ì˜¤ë²„ë ˆì´</h3>
                </div>
                <p>ìŠ¤íŠ¸ë¦¬ë¨¸ë³„ í›„ì› í˜„í™©ì„ í…Œì´ë¸” í˜•íƒœë¡œ ë³´ì—¬ì£¼ëŠ” ì˜¤ë²„ë ˆì´ì…ë‹ˆë‹¤.</p>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="openOverlay('streamer-table-overlay.html')">ğŸ“Š í…Œì´ë¸” ì˜¤ë²„ë ˆì´</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>ğŸ§ª í…ŒìŠ¤íŠ¸ ë„êµ¬</h3>
                </div>
                <p>ì„¤ì • í…ŒìŠ¤íŠ¸ ë° ë””ë²„ê¹…ì„ ìœ„í•œ ë„êµ¬ë“¤ì…ë‹ˆë‹¤.</p>
                <div class="btn-group">
                    <button class="btn btn-info" onclick="openOverlay('simple-overlay-test.html')">ğŸ§ª ê°„ë‹¨ í…ŒìŠ¤íŠ¸</button>
                    <button class="btn btn-warning" onclick="openOverlay('settings-debug.html')">ğŸ”§ ë””ë²„ê·¸ ë„êµ¬</button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>ğŸ›ï¸ ì‹¤ì‹œê°„ ì˜¤ë²„ë ˆì´ ì»¨íŠ¸ë¡¤</h3>
            </div>
            <div class="grid grid-4">
                <button class="btn btn-primary" onclick="sendOverlayCommand('align', 'left')">â† ì™¼ìª½ ì •ë ¬</button>
                <button class="btn btn-primary" onclick="sendOverlayCommand('align', 'center')">âš¬ ê°€ìš´ë° ì •ë ¬</button>
                <button class="btn btn-primary" onclick="sendOverlayCommand('align', 'right')">â†’ ì˜¤ë¥¸ìª½ ì •ë ¬</button>
                <button class="btn btn-success" onclick="sendOverlayCommand('size', 'increase')">ğŸ” ê¸€ì í¬ê²Œ</button>
            </div>
        </div>
    </div>

    <!-- ë””ë²„ê·¸ íƒ­ -->
    <div id="debug" class="tab-content">
        <div class="grid grid-2">
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ”§ ì‹œìŠ¤í…œ ìƒíƒœ</h3>
                </div>
                <div id="systemStatus">
                    <p><strong>ì„œë²„ ì—°ê²°:</strong> <span id="serverConnection">í™•ì¸ ì¤‘...</span></p>
                    <p><strong>Socket.io:</strong> <span id="socketStatus">í™•ì¸ ì¤‘...</span></p>
                    <p><strong>ë°ì´í„° ë™ê¸°í™”:</strong> <span id="syncStatus">í™•ì¸ ì¤‘...</span></p>
                    <p><strong>ì„¤ì • ìƒíƒœ:</strong> <span id="settingsStatus">í™•ì¸ ì¤‘...</span></p>
                </div>

                <div class="btn-group">
                    <button class="btn btn-danger" onclick="fixSettings()">ğŸ”§ ì„¤ì • êµ¬ì¡° ìˆ˜ì •</button>
                    <button class="btn btn-warning" onclick="forceReload()">ğŸ”„ ê°•ì œ ìƒˆë¡œê³ ì¹¨</button>
                    <button class="btn btn-info" onclick="exportData()">ğŸ’¾ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>ğŸ“Š ì‹¤ì‹œê°„ ë¡œê·¸</h3>
                </div>
                <div id="debugLog" class="log-output"></div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="clearLog()">ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°</button>
                    <button class="btn btn-info" onclick="downloadLog()">ğŸ’¾ ë¡œê·¸ ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>âš¡ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸</h3>
            </div>
            <div class="grid grid-4">
                <button class="btn btn-primary" onclick="testConnection()">ğŸ”— ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                <button class="btn btn-success" onclick="testSettings()">âš™ï¸ ì„¤ì • í…ŒìŠ¤íŠ¸</button>
                <button class="btn btn-warning" onclick="testOverlay()">ğŸ¥ ì˜¤ë²„ë ˆì´ í…ŒìŠ¤íŠ¸</button>
                <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
            </div>
        </div>
    </div>
</div>

<!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
<div id="alertMessage" class="alert"></div>

<!-- í”Œë¡œíŒ… ì˜¤ë²„ë ˆì´ ì»¨íŠ¸ë¡¤ -->
<div id="floatingControls" class="floating-overlay-controls">
    <h4>ğŸ›ï¸ ì˜¤ë²„ë ˆì´ ì»¨íŠ¸ë¡¤</h4>
    <div class="btn-group" style="flex-direction: column; gap: 5px;">
        <button class="btn btn-primary btn-sm" onclick="sendOverlayCommand('align', 'left')">â† ì™¼ìª½</button>
        <button class="btn btn-primary btn-sm" onclick="sendOverlayCommand('align', 'center')">âš¬ ê°€ìš´ë°</button>
        <button class="btn btn-primary btn-sm" onclick="sendOverlayCommand('align', 'right')">â†’ ì˜¤ë¥¸ìª½</button>
    </div>
</div>

<script>
// ì „ì—­ ë³€ìˆ˜
let socket = null;
let isConnected = false;
let currentData = {
    donations: [],
    streamers: [],
    emojis: {},
    settings: {}
};
let debugLogs = [];

// Socket.io ì´ˆê¸°í™”
function initializeSocket() {
    try {
        socket = io();
        
        socket.on('connect', () => {
            isConnected = true;
            updateConnectionStatus();
            log('ì„œë²„ ì—°ê²° ì„±ê³µ');
        });
        
        socket.on('disconnect', () => {
            isConnected = false;
            updateConnectionStatus();
            log('ì„œë²„ ì—°ê²° ëŠê¹€');
        });
        
        socket.on('initialData', (data) => {
            currentData = data;
            updateAllDisplays();
            log('ì´ˆê¸° ë°ì´í„° ìˆ˜ì‹ : ' + JSON.stringify(data, null, 2));
        });
        
        socket.on('dataUpdate', (data) => {
            currentData = data;
            updateAllDisplays();
            log('ë°ì´í„° ì—…ë°ì´íŠ¸: ' + JSON.stringify(data, null, 2));
        });
        
        socket.on('settingsUpdate', (settings) => {
            currentData.settings = settings;
            updateSettingsDisplay();
            log('ì„¤ì • ì—…ë°ì´íŠ¸: ' + JSON.stringify(settings, null, 2));
        });
        
        socket.on('userCount', (count) => {
            document.getElementById('connectedUsers').textContent = count;
        });
        
    } catch (error) {
        log('Socket.io ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message);
        loadDataFromAPI();
    }
}

// APIì—ì„œ ë°ì´í„° ë¡œë“œ
async function loadDataFromAPI() {
    try {
        const response = await fetch('/api/data');
        if (response.ok) {
            currentData = await response.json();
            updateAllDisplays();
            log('APIì—ì„œ ë°ì´í„° ë¡œë“œ ì„±ê³µ');
        }
    } catch (error) {
        log('API ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
    }
}

// ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
function updateConnectionStatus() {
    const dot = document.getElementById('connectionDot');
    const text = document.getElementById('connectionText');
    const status = document.getElementById('connectionStatus');
    
    if (isConnected) {
        dot.classList.remove('disconnected');
        text.textContent = 'ì‹¤ì‹œê°„ ì—°ê²°ë¨';
        status.className = 'status-indicator status-success';
    } else {
        dot.classList.add('disconnected');
        text.textContent = 'ì—°ê²° ëŠê¹€';
        status.className = 'status-indicator status-error';
    }
}

// ëª¨ë“  ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
function updateAllDisplays() {
    updateStats();
    updateDonationsList();
    updateStreamersList();
    updateSettingsDisplay();
    updateOverlayPreview();
}

// í†µê³„ ì—…ë°ì´íŠ¸
function updateStats() {
    const donations = currentData.donations || [];
    const totalAmount = donations.reduce((sum, d) => sum + (parseFloat(d.amount) || 0), 0);
    const totalCount = donations.length;
    const activeStreamers = (currentData.streamers || []).length;
    
    document.getElementById('totalAmount').textContent = totalAmount.toFixed(1);
    document.getElementById('totalCount').textContent = totalCount;
    document.getElementById('activeStreamers').textContent = activeStreamers;
}

// í›„ì› ëª©ë¡ ì—…ë°ì´íŠ¸
function updateDonationsList() {
    const donations = currentData.donations || [];
    const container = document.getElementById('donationsList');
    const recentContainer = document.getElementById('recentDonations');
    
    if (donations.length === 0) {
        const emptyHtml = '<div class="donation-item"><div class="donation-info"><div class="donation-donor">ì•„ì§ í›„ì›ì´ ì—†ìŠµë‹ˆë‹¤</div></div></div>';
        container.innerHTML = emptyHtml;
        recentContainer.innerHTML = emptyHtml;
        return;
    }
    
    const html = donations.slice(0, 10).map(donation => `
        <div class="donation-item">
            <div class="donation-info">
                <div class="donation-donor">${donation.donor}</div>
                <div class="donation-details">${donation.streamer} â€¢ ${donation.type} â€¢ ${new Date(donation.time).toLocaleString()}</div>
            </div>
            <div class="donation-amount">${donation.amount}ë§Œì›</div>
            <button class="btn btn-danger btn-sm" onclick="deleteDonation('${donation.time}')">ì‚­ì œ</button>
        </div>
    `).join('');
    
    container.innerHTML = html;
    recentContainer.innerHTML = donations.slice(0, 5).map(donation => `
        <div class="donation-item">
            <div class="donation-info">
                <div class="donation-donor">${donation.donor}</div>
                <div class="donation-details">${donation.streamer} â€¢ ${donation.amount}ë§Œì›</div>
            </div>
        </div>
    `).join('');
}

// ìŠ¤íŠ¸ë¦¬ë¨¸ ëª©ë¡ ì—…ë°ì´íŠ¸
function updateStreamersList() {
    const streamers = currentData.streamers || [];
    const emojis = currentData.emojis || {};
    const container = document.getElementById('streamersList');
    const select = document.getElementById('streamerSelect');
    
    // ìŠ¤íŠ¸ë¦¬ë¨¸ ëª©ë¡
    if (streamers.length === 0) {
        container.innerHTML = '<p>ì•„ì§ ìŠ¤íŠ¸ë¦¬ë¨¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
    } else {
        const html = streamers.map(streamer => `
            <div class="donation-item">
                <div class="donation-info">
                    <div class="donation-donor">${emojis[streamer] || 'ğŸ®'} ${streamer}</div>
                </div>
                <button class="btn btn-danger btn-sm" onclick="deleteStreamer('${streamer}')">ì‚­ì œ</button>
            </div>
        `).join('');
        container.innerHTML = html;
    }
    
    // ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
    select.innerHTML = '<option value="">ìŠ¤íŠ¸ë¦¬ë¨¸ ì„ íƒ</option>' + 
        streamers.map(streamer => `<option value="${streamer}">${emojis[streamer] || 'ğŸ®'} ${streamer}</option>`).join('');
}

// ì„¤ì • í‘œì‹œ ì—…ë°ì´íŠ¸
function updateSettingsDisplay() {
    const settings = currentData.settings || {};
    
    // ì˜¤ë²„ë ˆì´ ì„¤ì •
    const fontSize = settings['overlay-font-size'] || '24';
    const textAlign = settings['overlay-text-align'] || 'center';
    const strokeWidth = settings['overlay-stroke-width'] || '3';
    
    document.getElementById('overlayFontSize').value = fontSize;
    document.getElementById('overlayFontSizeValue').textContent = fontSize + 'px';
    document.getElementById('overlayTextAlign').value = textAlign;
    document.getElementById('overlayStrokeWidth').value = strokeWidth;
    document.getElementById('overlayStrokeWidthValue').textContent = strokeWidth + 'px';
    
    // í…Œì´ë¸” ì„¤ì •
    const tableOpacity = settings['table-opacity'] || '85';
    const tableFontSize = settings['table-font-size'] || '14';
    const tableTextColor = settings['table-text-color'] || '#ffffff';
    
    document.getElementById('tableOpacity').value = tableOpacity;
    document.getElementById('tableOpacityValue').textContent = tableOpacity + '%';
    document.getElementById('tableFontSize').value = tableFontSize;
    document.getElementById('tableFontSizeValue').textContent = tableFontSize + 'px';
    document.getElementById('tableTextColor').value = tableTextColor;
}

// ì˜¤ë²„ë ˆì´ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
function updateOverlayPreview() {
    const donations = currentData.donations || [];
    const settings = currentData.settings || {};
    
    // í›„ì›ìë³„ ì´ì•¡ ê³„ì‚°
    const donorTotals = {};
    donations.forEach(d => {
        if (d.type === 'ê³„ì¢Œ') {
            let cleanName = d.donor.replace(/\(ì¡°ì •[^)]*\)/g, '').trim();
            
            // ê³„ì¢Œí›„ì›ìë‹˜ì€ ê·¸ëŒ€ë¡œ í‘œì‹œ (íŠ¹ë³„ ì²˜ë¦¬)
            if (cleanName === 'ê³„ì¢Œí›„ì›ìë‹˜' || cleanName === 'ê³„ì¢Œí›„ì›ì') {
                cleanName = 'ê³„ì¢Œí›„ì›ìë‹˜';
            }
            
            const amount = parseFloat(d.amount) || 0;
            if (amount > 0 && cleanName) {
                donorTotals[cleanName] = (donorTotals[cleanName] || 0) + amount;
            }
        }
    });
    
    // í‘œì‹œ í…ìŠ¤íŠ¸ ìƒì„±
    const sortedDonors = Object.entries(donorTotals)
        .filter(([name, amount]) => amount > 0)
        .sort(([,a], [,b]) => b - a);
    
    let displayText = "ì‚¬ë‘í•´ìš”â™¡\n";
    if (sortedDonors.length > 0) {
        displayText += sortedDonors.slice(0, 5).map(([name, amount]) => 
            `${name}ë‹˜ ${amount.toFixed(1)}ë§Œ`
        ).join('\n');
    }
    
    const previewEl = document.getElementById('overlayPreviewText');
    previewEl.textContent = displayText;
    
    // ìŠ¤íƒ€ì¼ ì ìš©
    const fontSize = settings['overlay-font-size'] || '24';
    const textAlign = settings['overlay-text-align'] || 'center';
    const strokeWidth = settings['overlay-stroke-width'] || '3';
    
    const shadow = `${strokeWidth}px ${strokeWidth}px 0 #000000, -${strokeWidth}px -${strokeWidth}px 0 #000000, ${strokeWidth}px -${strokeWidth}px 0 #000000, -${strokeWidth}px ${strokeWidth}px 0 #000000`;
    
    previewEl.style.fontSize = fontSize + 'px';
    previewEl.style.textAlign = textAlign;
    previewEl.style.textShadow = shadow;
}

// íƒ­ ì „í™˜
function showTab(tabName) {
    // ëª¨ë“  íƒ­ ë‚´ìš© ìˆ¨ê¸°ê¸°
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // ì„ íƒëœ íƒ­ í™œì„±í™”
    document.getElementById(tabName).classList.add('active');
    event.target.classList.add('active');
}

// í›„ì› ì¶”ê°€
async function addDonation(donor, streamer, type, amount) {
    try {
        const response = await fetch('/api/donations', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ donor, streamer, type, amount: parseFloat(amount) })
        });
        
        const result = await response.json();
        if (result.success) {
            showAlert('í›„ì›ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            log(`í›„ì› ì¶”ê°€: ${donor} â†’ ${streamer} (${amount}ë§Œì›)`);
        } else {
            showAlert('í›„ì› ì¶”ê°€ ì‹¤íŒ¨: ' + result.error, 'error');
        }
    } catch (error) {
        showAlert('ì˜¤ë¥˜: ' + error.message, 'error');
        log('í›„ì› ì¶”ê°€ ì‹¤íŒ¨: ' + error.message);
    }
}

// ìŠ¤íŠ¸ë¦¬ë¨¸ ì¶”ê°€
async function addStreamer(name, emoji) {
    try {
        const response = await fetch('/api/streamers', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, emoji })
        });
        
        const result = await response.json();
        if (result.success) {
            showAlert('ìŠ¤íŠ¸ë¦¬ë¨¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            log(`ìŠ¤íŠ¸ë¦¬ë¨¸ ì¶”ê°€: ${name} ${emoji}`);
        } else {
            showAlert('ìŠ¤íŠ¸ë¦¬ë¨¸ ì¶”ê°€ ì‹¤íŒ¨: ' + result.error, 'error');
        }
    } catch (error) {
        showAlert('ì˜¤ë¥˜: ' + error.message, 'error');
        log('ìŠ¤íŠ¸ë¦¬ë¨¸ ì¶”ê°€ ì‹¤íŒ¨: ' + error.message);
    }
}

// í›„ì› ì‚­ì œ
async function deleteDonation(donationId) {
    if (!confirm('ì´ í›„ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    try {
        const response = await fetch(`/api/donations/${donationId}`, {
            method: 'DELETE'
        });
        
        const result = await response.json();
        if (result.success) {
            showAlert('í›„ì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            log(`í›„ì› ì‚­ì œ: ${donationId}`);
        } else {
            showAlert('í›„ì› ì‚­ì œ ì‹¤íŒ¨: ' + result.error, 'error');
        }
    } catch (error) {
        showAlert('ì˜¤ë¥˜: ' + error.message, 'error');
        log('í›„ì› ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
    }
}

// ìŠ¤íŠ¸ë¦¬ë¨¸ ì‚­ì œ
async function deleteStreamer(streamerName) {
    if (!confirm(`${streamerName} ìŠ¤íŠ¸ë¦¬ë¨¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
    
    try {
        const response = await fetch(`/api/streamers/${encodeURIComponent(streamerName)}`, {
            method: 'DELETE'
        });
        
        const result = await response.json();
        if (result.success) {
            showAlert('ìŠ¤íŠ¸ë¦¬ë¨¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            log(`ìŠ¤íŠ¸ë¦¬ë¨¸ ì‚­ì œ: ${streamerName}`);
        } else {
            showAlert('ìŠ¤íŠ¸ë¦¬ë¨¸ ì‚­ì œ ì‹¤íŒ¨: ' + result.error, 'error');
        }
    } catch (error) {
        showAlert('ì˜¤ë¥˜: ' + error.message, 'error');
        log('ìŠ¤íŠ¸ë¦¬ë¨¸ ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
    }
}

// ì„¤ì • ì ìš©
async function applyOverlaySettings() {
    const settings = {
        'overlay-font-size': document.getElementById('overlayFontSize').value,
        'overlay-text-align': document.getElementById('overlayTextAlign').value,
        'overlay-stroke-width': document.getElementById('overlayStrokeWidth').value
    };
    
    try {
        const response = await fetch('/api/settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ settings })
        });
        
        const result = await response.json();
        if (result.success) {
            showAlert('ì˜¤ë²„ë ˆì´ ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            log('ì˜¤ë²„ë ˆì´ ì„¤ì • ì ìš©: ' + JSON.stringify(settings));
        } else {
            showAlert('ì„¤ì • ì ìš© ì‹¤íŒ¨: ' + result.error, 'error');
        }
    } catch (error) {
        showAlert('ì˜¤ë¥˜: ' + error.message, 'error');
        log('ì„¤ì • ì ìš© ì‹¤íŒ¨: ' + error.message);
    }
}

// í…Œì´ë¸” ì„¤ì • ì ìš©
async function applyTableSettings() {
    const settings = {
        'table-opacity': document.getElementById('tableOpacity').value,
        'table-font-size': document.getElementById('tableFontSize').value,
        'table-text-color': document.getElementById('tableTextColor').value
    };
    
    try {
        const response = await fetch('/api/settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ settings })
        });
        
        const result = await response.json();
        if (result.success) {
            showAlert('í…Œì´ë¸” ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            log('í…Œì´ë¸” ì„¤ì • ì ìš©: ' + JSON.stringify(settings));
        } else {
            showAlert('ì„¤ì • ì ìš© ì‹¤íŒ¨: ' + result.error, 'error');
        }
    } catch (error) {
        showAlert('ì˜¤ë¥˜: ' + error.message, 'error');
        log('ì„¤ì • ì ìš© ì‹¤íŒ¨: ' + error.message);
    }
}

// ì„¤ì • êµ¬ì¡° ìˆ˜ì •
async function fixSettings() {
    try {
        showAlert('ì„¤ì • êµ¬ì¡°ë¥¼ ìˆ˜ì •í•˜ëŠ” ì¤‘...', 'info');
        
        const response = await fetch('/api/fix-settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        });
        
        const result = await response.json();
        if (result.success) {
            showAlert('ì„¤ì • êµ¬ì¡°ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            log('ì„¤ì • êµ¬ì¡° ìˆ˜ì • ì„±ê³µ');
            loadDataFromAPI(); // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
            showAlert('ì„¤ì • êµ¬ì¡° ìˆ˜ì • ì‹¤íŒ¨: ' + result.error, 'error');
        }
    } catch (error) {
        showAlert('ì˜¤ë¥˜: ' + error.message, 'error');
        log('ì„¤ì • êµ¬ì¡° ìˆ˜ì • ì‹¤íŒ¨: ' + error.message);
    }
}

// ì˜¤ë²„ë ˆì´ ì—´ê¸°
function openOverlay(fileName) {
    const url = window.location.origin + '/' + fileName;
    window.open(url, '_blank', 'width=800,height=600');
    log(`ì˜¤ë²„ë ˆì´ ì—´ê¸°: ${fileName}`);
}

// ì˜¤ë²„ë ˆì´ ëª…ë ¹ ì „ì†¡
async function sendOverlayCommand(type, value) {
    let settings = {};
    
    if (type === 'align') {
        settings['overlay-text-align'] = value;
    } else if (type === 'size') {
        const currentSize = parseInt(document.getElementById('overlayFontSize').value) || 24;
        const newSize = value === 'increase' ? currentSize + 2 : Math.max(10, currentSize - 2);
        settings['overlay-font-size'] = newSize.toString();
        document.getElementById('overlayFontSize').value = newSize;
        document.getElementById('overlayFontSizeValue').textContent = newSize + 'px';
    }
    
    try {
        const response = await fetch('/api/settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ settings })
        });
        
        if (response.ok) {
            showAlert('ì˜¤ë²„ë ˆì´ ëª…ë ¹ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            log('ì˜¤ë²„ë ˆì´ ëª…ë ¹ ì „ì†¡: ' + JSON.stringify(settings));
        }
    } catch (error) {
        log('ì˜¤ë²„ë ˆì´ ëª…ë ¹ ì „ì†¡ ì‹¤íŒ¨: ' + error.message);
    }
}

// ì•Œë¦¼ í‘œì‹œ
function showAlert(message, type = 'info') {
    const alertEl = document.getElementById('alertMessage');
    alertEl.textContent = message;
    alertEl.className = `alert alert-${type} show`;
    
    setTimeout(() => {
        alertEl.classList.remove('show');
    }, 3000);
}

// ë¡œê·¸ ê¸°ë¡
function log(message) {
    const timestamp = new Date().toLocaleTimeString();
    const logMessage = `[${timestamp}] ${message}`;
    debugLogs.push(logMessage);
    
    const logEl = document.getElementById('debugLog');
    if (logEl) {
        logEl.textContent = debugLogs.slice(-50).join('\n');
        logEl.scrollTop = logEl.scrollHeight;
    }
    
    console.log(logMessage);
}

// ë¡œê·¸ ì§€ìš°ê¸°
function clearLog() {
    debugLogs = [];
    document.getElementById('debugLog').textContent = '';
}

// í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
function testConnection() {
    loadDataFromAPI();
    showAlert('ì—°ê²° í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤.', 'info');
}

function testSettings() {
    const testSettings = {
        'overlay-font-size': '30',
        'overlay-text-align': 'center'
    };
    
    fetch('/api/settings', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ settings: testSettings })
    }).then(response => {
        if (response.ok) {
            showAlert('ì„¤ì • í…ŒìŠ¤íŠ¸ ì„±ê³µ!', 'success');
        } else {
            showAlert('ì„¤ì • í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨!', 'error');
        }
    });
}

function testOverlay() {
    openOverlay('simple-overlay-test.html');
    showAlert('í…ŒìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ë¥¼ ì—´ì—ˆìŠµë‹ˆë‹¤.', 'info');
}

function testOverlaySettings() {
    sendOverlayCommand('align', 'center');
    setTimeout(() => sendOverlayCommand('align', 'left'), 1000);
    setTimeout(() => sendOverlayCommand('align', 'right'), 2000);
    setTimeout(() => sendOverlayCommand('align', 'center'), 3000);
    showAlert('ì˜¤ë²„ë ˆì´ ì„¤ì • í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.', 'info');
}

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
document.addEventListener('DOMContentLoaded', () => {
    // Socket ì´ˆê¸°í™”
    initializeSocket();
    
    // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
    document.getElementById('overlayFontSize').addEventListener('input', (e) => {
        document.getElementById('overlayFontSizeValue').textContent = e.target.value + 'px';
    });
    
    document.getElementById('overlayStrokeWidth').addEventListener('input', (e) => {
        document.getElementById('overlayStrokeWidthValue').textContent = e.target.value + 'px';
    });
    
    document.getElementById('tableOpacity').addEventListener('input', (e) => {
        document.getElementById('tableOpacityValue').textContent = e.target.value + '%';
    });
    
    document.getElementById('tableFontSize').addEventListener('input', (e) => {
        document.getElementById('tableFontSizeValue').textContent = e.target.value + 'px';
    });
    
    // í¼ ì´ë²¤íŠ¸
    document.getElementById('newDonationForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const donor = document.getElementById('donorName').value;
        const streamer = document.getElementById('streamerSelect').value;
        const type = document.getElementById('donationType').value;
        const amount = document.getElementById('donationAmount').value;
        
        if (!donor || !streamer || !amount) {
            showAlert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        
        addDonation(donor, streamer, type, amount);
        
        // í¼ ë¦¬ì…‹
        e.target.reset();
    });
    
    document.getElementById('addStreamerForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('newStreamerName').value;
        const emoji = document.getElementById('newStreamerEmoji').value;
        
        if (!name) {
            showAlert('ìŠ¤íŠ¸ë¦¬ë¨¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        
        addStreamer(name, emoji);
        
        // í¼ ë¦¬ì…‹
        e.target.reset();
    });
    
    // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
    document.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case '1':
                    e.preventDefault();
                    showTab('dashboard');
                    break;
                case '2':
                    e.preventDefault();
                    showTab('donations');
                    break;
                case '3':
                    e.preventDefault();
                    showTab('streamers');
                    break;
                case '4':
                    e.preventDefault();
                    showTab('settings');
                    break;
                case '5':
                    e.preventDefault();
                    showTab('overlays');
                    break;
                case '6':
                    e.preventDefault();
                    showTab('debug');
                    break;
            }
        }
    });
    
    // ì£¼ê¸°ì  ì—…ë°ì´íŠ¸
    setInterval(() => {
        if (!isConnected) {
            loadDataFromAPI();
        }
        updateOverlayPreview();
    }, 5000);
    
    log('í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
});

// ì¶”ê°€ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
function resetOverlaySettings() {
    document.getElementById('overlayFontSize').value = 24;
    document.getElementById('overlayFontSizeValue').textContent = '24px';
    document.getElementById('overlayTextAlign').value = 'center';
    document.getElementById('overlayStrokeWidth').value = 3;
    document.getElementById('overlayStrokeWidthValue').textContent = '3px';
    
    applyOverlaySettings();
}

function forceReload() {
    location.reload();
}

function exportData() {
    const dataStr = JSON.stringify(currentData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `donation-data-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    URL.revokeObjectURL(url);
    
    showAlert('ë°ì´í„°ë¥¼ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤.', 'success');
}

function downloadLog() {
    const logStr = debugLogs.join('\n');
    const logBlob = new Blob([logStr], {type: 'text/plain'});
    const url = URL.createObjectURL(logBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `debug-log-${new Date().toISOString().split('T')[0]}.txt`;
    link.click();
    URL.revokeObjectURL(url);
    
    showAlert('ë¡œê·¸ë¥¼ ë‹¤ìš´ë¡œë“œí–ˆìŠµë‹ˆë‹¤.', 'success');
}

function clearAllData() {
    if (!confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        return;
    }
    
    if (!confirm('ë§ˆì§€ë§‰ í™•ì¸: ëª¨ë“  í›„ì› ë°ì´í„°ì™€ ì„¤ì •ì´ ì‚­ì œë©ë‹ˆë‹¤.')) {
        return;
    }
    
    // ì‹¤ì œë¡œëŠ” êµ¬í˜„í•˜ì§€ ì•ŠìŒ (ì•ˆì „ìƒì˜ ì´ìœ )
    showAlert('ë°ì´í„° ì‚­ì œ ê¸°ëŠ¥ì€ ì•ˆì „ìƒì˜ ì´ìœ ë¡œ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.', 'warning');
}
</script>

</body>
</html>