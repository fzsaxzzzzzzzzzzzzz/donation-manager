<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ”§ ê¸´ê¸‰ ìˆ˜ì • ë„êµ¬</title>
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background: #f5f5f5;
}
.card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    margin: 5px;
    transition: all 0.2s;
}
.btn-primary { background: #007bff; color: white; }
.btn-success { background: #28a745; color: white; }
.btn-warning { background: #ffc107; color: #212529; }
.btn:hover { opacity: 0.9; transform: translateY(-1px); }
.form-group { margin: 15px 0; }
.form-input { 
    width: 100%; 
    padding: 10px; 
    border: 1px solid #ddd; 
    border-radius: 4px; 
    font-size: 16px; 
}
.status {
    padding: 10px;
    border-radius: 4px;
    margin: 10px 0;
    font-weight: bold;
}
.status-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.status-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
</style>
</head>
<body>

<h1>ğŸ”§ í›„ì› ì‹œìŠ¤í…œ ê¸´ê¸‰ ìˆ˜ì • ë„êµ¬</h1>

<div class="card">
    <h3>1. ì´ëª¨ì§€ ì¦‰ì‹œ ë³µì›</h3>
    <p>ìŠ¤íŠ¸ë¦¬ë¨¸ ì´ëª¨ì§€ê°€ ì•ˆ ë³´ì¼ ë•Œ ì‚¬ìš©í•˜ì„¸ìš”.</p>
    <button onclick="fixEmojis()" class="btn btn-warning">ì´ëª¨ì§€ ë³µì›</button>
    <div id="emoji-status"></div>
</div>

<div class="card">
    <h3>2. ìŠ¤íŠ¸ë¦¬ë¨¸ ì¶”ê°€</h3>
    <div class="form-group">
        <input type="text" id="streamer-name" placeholder="ìŠ¤íŠ¸ë¦¬ë¨¸ ì´ë¦„" class="form-input">
    </div>
    <div class="form-group">
        <input type="text" id="streamer-emoji" placeholder="ì´ëª¨ì§€ (ì˜ˆ: ğŸ†•)" class="form-input">
    </div>
    <button onclick="addStreamer()" class="btn btn-success">ìŠ¤íŠ¸ë¦¬ë¨¸ ì¶”ê°€</button>
    <div id="streamer-status"></div>
</div>

<div class="card">
    <h3>3. ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™</h3>
    <button onclick="goToManager()" class="btn btn-primary">ê´€ë¦¬ì í˜ì´ì§€ ì—´ê¸°</button>
</div>

<script>
// ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ í˜„ì¬ ë°ì´í„° ë¡œë“œ
let streamers = [];
let emojis = {};

function loadCurrentData() {
    try {
        const savedStreamers = localStorage.getItem('streamers');
        const savedEmojis = localStorage.getItem('emojis');
        
        if (savedStreamers) {
            streamers = JSON.parse(savedStreamers);
        } else {
            streamers = ["ì—„ì‚¼ìš©", "ì†ë•ë°°", "ì—°ê¸°", "ì£¼ì˜¥", "ë¶ˆê³°", "ì´íš¨íŒ”", "ë™ë™", "ë‚¨ë¶•", "ì˜¥ê¸”", "êµ­ê³ "];
        }
        
        if (savedEmojis) {
            emojis = JSON.parse(savedEmojis);
        }
        
        console.log('í˜„ì¬ ë°ì´í„° ë¡œë“œë¨:', {streamers: streamers.length, emojis: Object.keys(emojis).length});
    } catch (error) {
        console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        streamers = ["ì—„ì‚¼ìš©", "ì†ë•ë°°", "ì—°ê¸°", "ì£¼ì˜¥", "ë¶ˆê³°", "ì´íš¨íŒ”", "ë™ë™", "ë‚¨ë¶•", "ì˜¥ê¸”", "êµ­ê³ "];
        emojis = {};
    }
}

function showStatus(elementId, message, type) {
    const element = document.getElementById(elementId);
    element.innerHTML = `<div class="status status-${type}">${message}</div>`;
    setTimeout(() => {
        element.innerHTML = '';
    }, 3000);
}

function fixEmojis() {
    // ëª¨ë“  ì´ëª¨ì§€ ì„¤ì •
    emojis = {
        "ì—„ì‚¼ìš©": "ğŸ«…", 
        "ì†ë•ë°°": "ğŸŒº", 
        "ì—°ê¸°": "ğŸ§", 
        "ë™ë™": "ğŸ˜", 
        "ì£¼ì˜¥": "ğŸ‘º", 
        "ë¶ˆê³°": "ğŸ¬", 
        "ì´íš¨íŒ”": "ğŸ", 
        "ë‚¨ë¶•": "ğŸ¤ ", 
        "ì˜¥ê¸”": "ğŸ¦†", 
        "êµ­ê³ ": "ğŸ¦"
    };
    
    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
    localStorage.setItem('emojis', JSON.stringify(emojis));
    localStorage.setItem('streamers', JSON.stringify(streamers));
    
    // ì„œë²„ì—ë„ ì „ì†¡ ì‹œë„
    fetch('/api/settings', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 'emoji-data': JSON.stringify(emojis) })
    }).then(response => {
        if (response.ok) {
            console.log('ì„œë²„ì—ë„ ì €ì¥ë¨');
        }
    }).catch(e => {
        console.log('ì„œë²„ ì €ì¥ ì‹¤íŒ¨ (ë¡œì»¬ë§Œ ì €ì¥ë¨)');
    });
    
    showStatus('emoji-status', 'âœ… ì´ëª¨ì§€ê°€ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤! ê´€ë¦¬ì í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.', 'success');
}

function addStreamer() {
    const name = document.getElementById('streamer-name').value.trim();
    const emoji = document.getElementById('streamer-emoji').value.trim();
    
    if (!name) {
        showStatus('streamer-status', 'âŒ ìŠ¤íŠ¸ë¦¬ë¨¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
        return;
    }
    
    if (streamers.includes(name)) {
        showStatus('streamer-status', 'âŒ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ìŠ¤íŠ¸ë¦¬ë¨¸ì…ë‹ˆë‹¤.', 'error');
        return;
    }
    
    // ìŠ¤íŠ¸ë¦¬ë¨¸ ì¶”ê°€
    streamers.push(name);
    if (emoji) {
        emojis[name] = emoji;
    }
    
    // ì €ì¥
    localStorage.setItem('streamers', JSON.stringify(streamers));
    localStorage.setItem('emojis', JSON.stringify(emojis));
    
    // ì„œë²„ì—ë„ ì „ì†¡ ì‹œë„
    fetch('/api/streamers', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, emoji })
    }).then(response => {
        if (response.ok) {
            console.log('ì„œë²„ì—ë„ ì €ì¥ë¨');
        }
    }).catch(e => {
        console.log('ì„œë²„ ì €ì¥ ì‹¤íŒ¨ (ë¡œì»¬ë§Œ ì €ì¥ë¨)');
    });
    
    // ì…ë ¥ì°½ ì´ˆê¸°í™”
    document.getElementById('streamer-name').value = '';
    document.getElementById('streamer-emoji').value = '';
    
    showStatus('streamer-status', `âœ… ${name} ${emoji} ìŠ¤íŠ¸ë¦¬ë¨¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
}

function goToManager() {
    window.open('/donation-manager.html', '_blank');
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë“œ
loadCurrentData();
</script>

</body>
</html>