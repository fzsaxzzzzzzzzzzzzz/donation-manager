<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“± í°ë°©ì†¡ìš© í›„ì›ì ì˜¤ë²„ë ˆì´ v2.0</title>

<!-- Socket.IO for Real-time -->
<script src="/socket.io/socket.io.js"></script>
<style>
body {
    margin: 0;
    padding: 20px;
    background: transparent;
    font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
    color: white;
    overflow: visible;
    /* ê·¹í•œ ë°°í„°ë¦¬ ì ˆì•½: í•˜ë“œì›¨ì–´ ê°€ì† ì™„ì „ ë¹„í™œì„±í™” */
    transform: none;
    -webkit-transform: none;
    will-change: auto;
}

/* ëª¨ë°”ì¼ ë°°í„°ë¦¬ ì ˆì•½ ìµœì í™” */
@media (max-width: 768px) {
    body {
        padding: 10px;
        font-size: 14px;
        /* GPU ê°€ì† ì™„ì „ ë¹„í™œì„±í™” */
        -webkit-transform: none;
        transform: none;
        will-change: auto;
    }
}

.overlay-container {
    background: transparent;
    width: 100%;
    overflow: visible !important;
}

.donor-content {
    font-size: var(--overlay-font-size, 18px) !important;
    font-weight: bold;
    color: var(--overlay-text-color, white);
    text-shadow: var(--overlay-text-shadow, 3px 3px 0 #000000, -3px -3px 0 #000000, 3px -3px 0 #000000, -3px 3px 0 #000000, 3px 0px 0 #000000, -3px 0px 0 #000000, 0px 3px 0 #000000, 0px -3px 0 #000000) !important;
    line-height: var(--overlay-line-height, 1.5);
    white-space: pre-line;
    padding: 0;
    text-align: var(--overlay-text-align, left) !important;
    transition: opacity 0.3s ease;
}

.no-data {
    font-size: var(--overlay-font-size, 20px) !important;
    font-weight: bold;
    color: var(--overlay-text-color, white) !important;
    text-shadow: var(--overlay-text-shadow, 3px 3px 0 #000000, -3px -3px 0 #000000, 3px -3px 0 #000000, -3px 3px 0 #000000) !important;
    text-align: var(--overlay-text-align, center) !important;
    padding: 40px 20px;
}

.loading {
    color: #87CEEB;
    text-align: center;
    font-size: 16px;
}

/* ì¹´ì¹´ì˜¤ë±…í¬ ì „ìš© ìŠ¤íƒ€ì¼ - ë…ë¦½ì ì¸ í¬ê¸° ì„¤ì • */
.kakao-bank-info {
    margin: 0 !important;
    padding: 0 !important;
    display: block !important;
    white-space: nowrap !important;
}

.kakao-bank-info div {
    margin: 0 !important;
    padding: 0 !important;
    font-weight: bold !important;
    color: #FFEB3B !important;
}

/* í›„ì›ì í…ìŠ¤íŠ¸ì™€ ì¹´ì¹´ì˜¤ë±…í¬ ê°„ê²© ìµœì í™” */
.donor-text {
    margin-top: 0 !important;
    padding-top: 0 !important;
    line-height: 1.0 !important;
}

/* í›„ì›ì í•­ëª© - ë¦¬ìŠ¤íŠ¸ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ */
.donor-item {
    display: inline-block;
    white-space: nowrap;
    margin-right: 0.5em;
}

/* <br> íƒœê·¸ ê°„ê²© ìµœì í™” - ì™„ì „ ê³ ì • */
.donor-text br,
br {
    line-height: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    height: 0 !important;
    display: block !important;
}

/* ëª¨ë“  ì• ë‹ˆë©”ì´ì…˜ ì™„ì „ ë¹„í™œì„±í™” + ê°„ê²© í†µì œ */
* {
    animation: none !important;
    transition: none !important;
    transform: none !important;
    will-change: auto !important;
}

/* ì „ì²´ ê°„ê²© ì™„ì „ í†µì œ - ì¹´ì¹´ì˜¤ë±…í¬ ê´€ë ¨ */
div, span, p, br {
    margin: 0 !important;
    padding: 0 !important;
    line-height: inherit !important;
}

/* ì—°ê²° ìƒíƒœ í‘œì‹œ ì œê±°ë¨ */

/* ì´ì•¡ ê·¸ë˜í”„ */
.goal-section{margin-bottom:8px;display:none;width:var(--goal-width, 100%);align-self:var(--goal-align, flex-start)}
.goal-section.show{display:block}
.goal-section.pos-bottom{order:10;margin-bottom:0;margin-top:8px}
.goal-title{text-align:center;margin-bottom:6px;font-size:var(--goal-title-size,18px);font-weight:bold;color:white;text-shadow:1px 1px 0 #000,-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,2px 2px 4px rgba(0,0,0,.8)}
.goal-bar-wrap{width:100%;height:var(--goal-bar-height,30px);background:linear-gradient(90deg,#2c2c2c,#404040);border-radius:15px;overflow:hidden;border:3px solid #555;box-shadow:inset 0 3px 8px rgba(0,0,0,.6);position:relative}
.goal-bar{height:100%;background:linear-gradient(90deg,#ff6b35,#ff8a50,#ffa726);width:0%;border-radius:12px;position:relative;box-shadow:0 3px 15px rgba(255,107,53,.6)}
.goal-bar::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent 0%,rgba(255,255,255,.4) 50%,transparent 100%);border-radius:12px}
.goal-text{position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:var(--goal-text-size,16px);text-shadow:1px 1px 0 #000,-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,2px 2px 4px rgba(0,0,0,.8);z-index:10;white-space:nowrap}

/* í€ë”© ë¯¸ì…˜ */
.goal-missions{display:none;margin-top:4px}
.goal-missions.visible{display:block}
.gm-card{position:relative;width:100%;height:var(--gm-height,24px);background:rgba(30,30,30,.85);border-radius:12px;margin-bottom:3px;overflow:hidden;border:2px solid rgba(255,255,255,.15)}
.gm-bar{position:absolute;left:0;top:0;height:100%;background:linear-gradient(90deg,#059669,#10b981,#34d399);border-radius:10px}
.gm-bar.done{background:linear-gradient(90deg,#d97706,#f59e0b,#fbbf24)}
.gm-info{position:relative;z-index:10;display:flex;justify-content:space-between;align-items:center;height:100%;padding:0 10px;font-size:var(--gm-font,13px);font-weight:bold;color:#fff;text-shadow:1px 1px 0 #000,-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000}
.gm-info .gm-l{display:flex;align-items:center;gap:4px}
.gm-info .gm-r{display:flex;align-items:center;gap:6px}
.gm-pct.done{color:#fef08a}

.overlay-container{display:flex;flex-direction:column}

/* í¬ë¡œë§ˆí‚¤ ì§€ì› */
.transparent-mode {
    background: #00FF00;
}
</style>
</head>
<body>

<div class="overlay-container">
    <div class="goal-section" id="goal-section">
        <div class="goal-title" id="goal-title" style="display:none">ì˜¤ëŠ˜ì˜ ëª©í‘œ</div>
        <div class="goal-bar-wrap">
            <div class="goal-text" id="goal-text">0 / 50ë§Œì› (0%)</div>
            <div class="goal-bar" id="goal-bar"></div>
        </div>
        <div class="goal-missions" id="goal-missions"></div>
    </div>
    <div class="donor-content" id="donor-content">
        <div class="loading">ì‹¤ì‹œê°„ ì„œë²„ ì—°ê²° ì¤‘...</div>
    </div>
</div>

<!-- ì—°ê²° ìƒíƒœ í‘œì‹œ ì œê±°ë¨ -->

<script>
class RealtimeDonorOverlay {
    constructor() {
        console.log('ğŸ“± ëª¨ë°”ì¼ ì „ìš© í›„ì›ìë³„ ì´ì•¡ ì˜¤ë²„ë ˆì´ ì‹œì‘');
        
        this.socket = io();
        this.donations = [];
        this.settings = {
            'overlay-font-size': 16,
            'overlay-stroke-width': 2,
            'overlay-text-align': 'left',
            'includeSuperchat': localStorage.getItem('include-superchat') === 'true'
        };
        this.dailyGoal = { target: 50 };
        this.missions = [];
        this.emojis = {};
        this.missionAdjustments = [];
        this.currentTextMode = 'progress';
        this.goalTextSwitchInterval = null;
        this.isConnected = false;
        this.batterySaveMode = false;

        // ê·¹í•œ ë°°í„°ë¦¬ ì ˆì•½ ëª¨ë“œ í™œì„±í™”
        this.enableBatterySaving();
        this.enableCPUThrottling();
        this.initializeSocket();
        this.setupKeyboardControls();
    }
    
    enableCPUThrottling() {
        // CPU ì‚¬ìš©ëŸ‰ ê·¹í•œ ìµœì í™”
        if ('requestIdleCallback' in window) {
            this.useIdleCallback = true;
            console.log('ğŸ“± idle callback í™œì„±í™” - CPU ë¶€í•˜ ìµœì†Œí™”');
        }
        
        // ë°°í„°ë¦¬ API ì‚¬ìš© ê°€ëŠ¥ ì‹œ ë°°í„°ë¦¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§
        if ('getBattery' in navigator) {
            navigator.getBattery().then(battery => {
                this.battery = battery;
                console.log(`ğŸ“± ë°°í„°ë¦¬ ìˆ˜ì¤€: ${Math.round(battery.level * 100)}%`);
                
                // ëª¨ë°”ì¼ ì „ìš©: 20% ì´í•˜ì—ì„œ ê·¹í•œ ì ˆì•½
                const threshold = 0.20;
                if (battery.level < threshold) {
                    this.enableUltraPowerSaveMode();
                }
                
                battery.addEventListener('levelchange', () => {
                    const level = Math.round(battery.level * 100);
                    console.log(`ğŸ“± ë°°í„°ë¦¬ ë³€ê²½: ${level}%`);
                    
                    if (battery.level < threshold && !this.ultraPowerSave) {
                        this.enableUltraPowerSaveMode();
                    } else if (battery.level > (threshold + 0.1) && this.ultraPowerSave) {
                        this.disableUltraPowerSaveMode();
                    }
                });
            });
        }
        
        // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì†Œí™”
        this.minimizeMemoryUsage();
    }
    
    enableUltraPowerSaveMode() {
        console.log('ğŸ”´ ëª¨ë°”ì¼ ê·¹í•œ ì ˆì•½ ëª¨ë“œ í™œì„±í™” - 2ì´ˆì— 1ë²ˆ ì—…ë°ì´íŠ¸');
        this.ultraPowerSave = true;
        this.maxFPS = 0.5; // 2ì´ˆì— 1ë²ˆ
        this.frameInterval = 2000;
        
        // ì¹´ì¹´ì˜¤ë±…í¬ íƒ€ì´ë¨¸ ì—°ì¥
        if (this.kakaoBankTimer) {
            clearInterval(this.kakaoBankTimer);
            this.kakaoBankTimer = setInterval(() => {
                if (!this.batterySaveMode) {
                    this.forceKakaoBankProtection();
                }
            }, 30000);
        }
    }
    
    disableUltraPowerSaveMode() {
        console.log('ğŸŸ¢ ëª¨ë°”ì¼ ê·¹í•œ ì ˆì•½ ëª¨ë“œ í•´ì œ - 1fps ë³µêµ¬');
        this.ultraPowerSave = false;
        this.maxFPS = 1;
        this.frameInterval = 1000;
        
        // ì¹´ì¹´ì˜¤ë±…í¬ íƒ€ì´ë¨¸ ë³µêµ¬
        if (this.kakaoBankTimer) {
            clearInterval(this.kakaoBankTimer);
            this.kakaoBankTimer = setInterval(() => {
                if (!this.batterySaveMode) {
                    this.forceKakaoBankProtection();
                }
            }, 15000); // ëª¨ë°”ì¼ ì „ìš© 15ì´ˆ ê°„ê²©
        }
    }
    
    minimizeMemoryUsage() {
        // ëª¨ë°”ì¼ ì „ìš© ë©”ëª¨ë¦¬ ì •ë¦¬ - 1ë¶„ë§ˆë‹¤
        setInterval(() => {
            // ì˜¤ë˜ëœ í›„ì› ë°ì´í„° ì •ë¦¬ - 25ê°œ ì´ˆê³¼ ì‹œ
            if (this.donations && this.donations.length > 25) {
                this.donations = this.donations.slice(-15); // ìµœê·¼ 15ê°œë§Œ ìœ ì§€
                console.log('ğŸ“± ëª¨ë°”ì¼ ë©”ëª¨ë¦¬ ì •ë¦¬: ìµœê·¼ 15ê°œë§Œ ìœ ì§€');
            }
        }, 60000);
    }
    
    enableBatterySaving() {
        // ë°±ê·¸ë¼ìš´ë“œ/í¬ê·¸ë¼ìš´ë“œ ê°ì§€
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                console.log('ğŸ“± ì•±ì´ ë°±ê·¸ë¼ìš´ë“œë¡œ ì´ë™ - ì ˆì „ ëª¨ë“œ');
                this.batterySaveMode = true;
                this.pauseAllTimers();
            } else {
                console.log('ğŸ“± ì•±ì´ í¬ê·¸ë¼ìš´ë“œë¡œ ë³µê·€');
                this.batterySaveMode = false;
                this.resumeAllTimers();
                this.updateDisplay();
            }
        });
        
        // ëª¨ë°”ì¼ ì „ìš© ê·¹í•œ FPS ì œí•œ
        this.maxFPS = 1;
        this.frameInterval = 1000;
        this.lastFrameTime = 0;
        this.updateThrottle = false;
        
        console.log('ğŸ“± ëª¨ë°”ì¼ ì „ìš© ê·¹í•œ ìµœì í™”: 1fps');
    }
    
    pauseAllTimers() {
        if (this.kakaoBankTimer) {
            clearInterval(this.kakaoBankTimer);
            this.kakaoBankTimer = null;
        }
    }
    
    resumeAllTimers() {
        if (!this.kakaoBankTimer) {
            this.kakaoBankTimer = setInterval(() => {
                if (!this.batterySaveMode) {
                    this.forceKakaoBankProtection();
                }
            }, 15000); // ëª¨ë°”ì¼ ì „ìš© 15ì´ˆ ê°„ê²© // ë””ë°”ì´ìŠ¤ë³„ ì°¨ë“± ì ìš©
        }
    }
    
    setupMemoryOptimization() {
        // ëª¨ë°”ì¼ ì „ìš© ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ - 30ì´ˆë§ˆë‹¤
        const gcInterval = 30000;
        setInterval(() => {
            if (window.gc && typeof window.gc === 'function') {
                window.gc();
            }
        }, gcInterval);
    }
    
    initializeSocket() {
        this.socket.on('connect', () => {
            this.isConnected = true;
            console.log('ğŸ”— ì‹¤ì‹œê°„ ì„œë²„ ì—°ê²°ë¨');
        });
        
        this.socket.on('disconnect', () => {
            this.isConnected = false;
            console.log('âŒ ì‹¤ì‹œê°„ ì„œë²„ ì—°ê²° ëŠì–´ì§');
            this.showError('ì„œë²„ì™€ì˜ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.');
        });
        
        this.socket.on('initialData', (data) => {
            console.log('ğŸ“Š ì´ˆê¸° ë°ì´í„° ìˆ˜ì‹ :', data);
            this.donations = data.donations || [];
            this.missions = data.missions || data.runningMissions || [];
            this.emojis = data.emojis || {};
            this.missionAdjustments = data.missionAdjustments || [];
            const initialSettings = data.settings || {};
            this.settings = { ...this.settings, ...initialSettings };
            this.dailyGoal = initialSettings.dailyGoal || { target: 50 };
            this.applySettings();
            this.updateGoalGraph();
            this.renderMissions();
            this.updateDisplay();
        });
        
        this.socket.on('dataUpdate', (data) => {
            // ë°°í„°ë¦¬ ì ˆì•½: ë°±ê·¸ë¼ìš´ë“œì—ì„œëŠ” ì—…ë°ì´íŠ¸ ìŠ¤í‚µ
            if (this.batterySaveMode) {
                console.log('ğŸ“± ì ˆì „ ëª¨ë“œ: ì—…ë°ì´íŠ¸ ìŠ¤í‚µ');
                return;
            }

            console.log('ğŸ”„ ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :', data.donations?.length || 0, 'ê±´');
            this.donations = data.donations || [];
            this.missions = data.missions || data.runningMissions || this.missions;
            this.emojis = data.emojis || this.emojis;
            this.missionAdjustments = data.missionAdjustments || this.missionAdjustments;

            if (data.settings) {
                console.log('âš™ï¸ ì„¤ì • ì—…ë°ì´íŠ¸ í¬í•¨:', Object.keys(data.settings));
                this.settings = { ...this.settings, ...data.settings };
                this.dailyGoal = data.settings.dailyGoal || this.dailyGoal;
                this.applySettings();
            }

            this.updateGoalGraph();
            this.renderMissions();
            this.throttledUpdate();
            this.flashUpdate();
        });
        
        this.socket.on('settingsUpdate', (settings) => {
            console.log('âš™ï¸ ì„¤ì • ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :', settings);
            this.settings = { ...this.settings, ...settings };
            this.dailyGoal = settings.dailyGoal || this.dailyGoal;
            this.applySettings();
            this.updateGoalGraph();
            this.renderMissions();
            this.updateDisplay();
        });
    }
    
    // ë°œì—´ ë°©ì§€: ì—…ë°ì´íŠ¸ ì“°ë¡œí‹€ë§
    throttledUpdate() {
        // ëª¨ë°”ì¼ì´ ì•„ë‹ˆë©´ ë°”ë¡œ ì—…ë°ì´íŠ¸
        if (!this.isMobile && !this.isSmallScreen) {
            this.updateDisplay();
            return;
        }
        
        if (this.updateThrottle) return;
        
        const now = performance.now();
        if (now - this.lastFrameTime < this.frameInterval) {
            return;
        }
        
        this.updateThrottle = true;
        this.lastFrameTime = now;
        
        if (this.batterySaveMode) {
            this.updateThrottle = false;
            return;
        }
        
        // ëª¨ë°”ì¼ ì „ìš© ê·¹í•œ ë°°í„°ë¦¬ ì ˆì•½: idle callback ìš°ì„  ì‚¬ìš©
        if (this.useIdleCallback && !this.ultraPowerSave) {
            requestIdleCallback(() => {
                this.updateDisplay();
                this.updateThrottle = false;
            }, { timeout: 2000 });
        } else {
            // ê·¹í•œ ëª¨ë“œ: setTimeoutìœ¼ë¡œ CPU ë¶€í•˜ ìµœì†Œí™”
            setTimeout(() => {
                this.updateDisplay();
                this.updateThrottle = false;
            }, 100);
        }
    }
    
    // ë‘êº¼ìš´ ì™¸ê³½ì„ ì—ì„œë„ ê¹¨ì§€ì§€ ì•ŠëŠ” text-shadow ìƒì„± í•¨ìˆ˜
    generateTextShadow(maxWidth, color = '#000000') {
        const shadows = [];
        const width = Math.ceil(maxWidth);

        // 1pxë¶€í„° maxWidthê¹Œì§€ ëª¨ë“  ë ˆì´ì–´ì— ì´˜ì´˜í•˜ê²Œ shadow ìƒì„±
        for (let i = 1; i <= width; i++) {
            // 8ë°©í–¥ shadow
            shadows.push(`${i}px 0 0 ${color}`);
            shadows.push(`-${i}px 0 0 ${color}`);
            shadows.push(`0 ${i}px 0 ${color}`);
            shadows.push(`0 -${i}px 0 ${color}`);
            shadows.push(`${i}px ${i}px 0 ${color}`);
            shadows.push(`-${i}px -${i}px 0 ${color}`);
            shadows.push(`${i}px -${i}px 0 ${color}`);
            shadows.push(`-${i}px ${i}px 0 ${color}`);
        }

        return shadows.join(', ');
    }

    applySettings() {
        const root = document.documentElement;
        const fontSize = parseInt(this.settings['overlay-font-size']) || 18;
        const strokeWidth = parseFloat(this.settings['overlay-stroke-width']) || 3;
        const textAlign = this.settings['overlay-text-align'] || 'left';
        const lineHeight = parseFloat(this.settings['overlay-line-height']) || 1.5;

        root.style.setProperty('--overlay-font-size', fontSize + 'px');
        root.style.setProperty('--overlay-text-align', textAlign);
        root.style.setProperty('--overlay-line-height', lineHeight);
        root.style.setProperty('--overlay-text-shadow', this.generateTextShadow(strokeWidth));

        // í›„ì›ì í…ìŠ¤íŠ¸ ìƒ‰ìƒ
        const textColor = this.settings['overlay-text-color'] || '#ffffff';
        root.style.setProperty('--overlay-text-color', textColor);

        // ì´ì•¡ ê·¸ë˜í”„ ì„¤ì • ì ìš©
        const goalSection = document.getElementById('goal-section');
        const showGoal = this.settings['donor-overlay-show-goal'] === true || this.settings['donor-overlay-show-goal'] === 'true';
        const goalPosition = this.settings['donor-overlay-goal-position'] || 'top';
        const goalWidth = parseInt(this.settings['donor-overlay-goal-width']) || 100;

        goalSection.classList.toggle('show', showGoal);
        goalSection.classList.toggle('pos-bottom', goalPosition === 'bottom');
        root.style.setProperty('--goal-width', goalWidth + '%');

        // ê·¸ë˜í”„ ì¢Œì¤‘ìš° ì •ë ¬
        const goalAlign = this.settings['donor-overlay-goal-align'] || 'left';
        const alignMap = { left: 'flex-start', center: 'center', right: 'flex-end' };
        root.style.setProperty('--goal-align', alignMap[goalAlign] || 'flex-start');

        // í€ë”© ë¯¸ì…˜ í‘œì‹œ
        const showMissions = this.settings['total-show-missions'] === true || this.settings['total-show-missions'] === 'true';
        const missionsEl = document.getElementById('goal-missions');
        if (missionsEl) missionsEl.classList.toggle('visible', showMissions);
        const missionHeight = this.settings['total-mission-height'] || 24;
        const missionFont = this.settings['total-mission-font-size'] || 13;
        root.style.setProperty('--gm-height', missionHeight + 'px');
        root.style.setProperty('--gm-font', missionFont + 'px');

        // ê·¸ë˜í”„ í¬ê¸° ì„¤ì • ë°˜ì˜
        const barHeight = this.settings['total-goal-progress-height'] || 30;
        const barTextSize = this.settings['total-goal-progress-text-size'] || 16;
        const titleSize = this.settings['total-goal-title-font-size'] || 18;
        root.style.setProperty('--goal-bar-height', barHeight + 'px');
        root.style.setProperty('--goal-text-size', barTextSize + 'px');
        root.style.setProperty('--goal-title-size', titleSize + 'px');

        // ëª©í‘œ ì œëª© í‘œì‹œ
        const goalTitle = document.getElementById('goal-title');
        const customTitle = this.settings['total-goal-custom-title'] || '';
        const showTitle = this.settings['total-goal-show-title'] !== false;
        goalTitle.style.display = (showTitle && customTitle) ? 'block' : 'none';
        if (customTitle) goalTitle.textContent = customTitle;

        // í…ìŠ¤íŠ¸ ì „í™˜ ì„¤ì • (ì„¤ì • ë³€ê²½ ì‹œì—ë§Œ ì¬ì„¤ì •)
        const switchKey = `${this.settings['total-goal-text-switch-enabled']}_${this.settings['total-goal-text-switch-interval']}`;
        if (this._lastSwitchKey !== switchKey) {
            this._lastSwitchKey = switchKey;
            this.setupGoalTextSwitch();
        }

        console.log('ğŸ”§ ì„¤ì • ì ìš©ë¨:', { fontSize, strokeWidth, textAlign, lineHeight, showGoal, goalPosition, goalWidth, goalAlign });
    }
    
    setupGoalTextSwitch() {
        if (this.goalTextSwitchInterval) {
            clearInterval(this.goalTextSwitchInterval);
            this.goalTextSwitchInterval = null;
        }
        const val = this.settings['total-goal-text-switch-enabled'];
        const enabled = val === true || val === 'true' || val === 1;
        console.log('ğŸ”„ í…ìŠ¤íŠ¸ ì „í™˜ ì„¤ì •:', { raw: val, enabled });
        if (enabled) {
            const sec = (parseInt(this.settings['total-goal-text-switch-interval']) || 5) * 1000;
            console.log(`ğŸ”„ í…ìŠ¤íŠ¸ ì „í™˜ ì‹œì‘: ${sec/1000}ì´ˆ ê°„ê²©`);
            this.goalTextSwitchInterval = setInterval(() => {
                this.currentTextMode = this.currentTextMode === 'progress' ? 'remaining' : 'progress';
                console.log('ğŸ”„ í…ìŠ¤íŠ¸ ëª¨ë“œ ì „í™˜:', this.currentTextMode);
                this.updateGoalGraph();
            }, sec);
        } else {
            this.currentTextMode = 'progress';
        }
    }

    updateGoalGraph() {
        const showGoal = this.settings['donor-overlay-show-goal'] === true || this.settings['donor-overlay-show-goal'] === 'true';
        if (!showGoal) return;

        const donationTotal = this.donations
            .filter(d => !d.excludeFromTotal && !d.isMissionAdjustment)
            .reduce((sum, d) => sum + (parseFloat(d.amount) || 0), 0);

        const initialAmount = parseFloat(this.dailyGoal.initialAmount) || 0;
        const currentAmount = donationTotal + initialAmount;
        let targetAmount = parseFloat(this.dailyGoal.target) || 50;

        // ìë™ ì—°ì¥
        if ((this.dailyGoal.autoExtendEnabled || this.dailyGoal.autoExtend) && currentAmount >= targetAmount) {
            const extendAmount = parseFloat(this.dailyGoal.extendAmount) || 50;
            targetAmount = Math.ceil(currentAmount / extendAmount) * extendAmount + extendAmount;
        }

        const progressPercent = targetAmount > 0 ? Math.min((currentAmount / targetAmount) * 100, 100) : 0;
        const remainingAmount = Math.max(targetAmount - currentAmount, 0);
        const formatAmt = (n) => n % 1 === 0 ? Math.floor(n).toString() : n.toFixed(1);

        // í…ìŠ¤íŠ¸ ì „í™˜
        const goalText = document.getElementById('goal-text');
        const goalBar = document.getElementById('goal-bar');
        if (goalText) {
            if (this.currentTextMode === 'remaining') {
                goalText.textContent = remainingAmount > 0
                    ? `ëª©í‘œê¹Œì§€ ${formatAmt(remainingAmount)}ë§Œì› ë‚¨ìŒ`
                    : `ëª©í‘œ ë‹¬ì„±! (+${formatAmt(currentAmount - targetAmount)}ë§Œì›)`;
            } else {
                goalText.textContent = `${formatAmt(currentAmount)} / ${formatAmt(targetAmount)}ë§Œì› (${Math.round(progressPercent)}%)`;
            }
        }
        if (goalBar) goalBar.style.width = `${Math.min(progressPercent, 100)}%`;
    }

    renderMissions() {
        const showMissions = this.settings['total-show-missions'] === true || this.settings['total-show-missions'] === 'true';
        if (!showMissions) return;
        const el = document.getElementById('goal-missions');
        if (!el) return;

        const running = (this.missions || []).filter(m => m && (m.status === 'running' || m.status === 'completed'));
        if (running.length === 0) { el.innerHTML = ''; return; }

        const fmt = (n) => n % 1 === 0 ? Math.floor(n) : n.toFixed(1);
        el.innerHTML = running.map(m => {
            const target = parseFloat(m.target) || 0;
            const init = parseFloat(m.initialAmount) || 0;
            const donated = this.donations
                .filter(d => d.streamer === m.streamer && new Date(d.time) >= new Date(m.startTime))
                .reduce((s, d) => s + (parseFloat(d.amount) || 0), 0);
            const adjusted = (this.missionAdjustments || [])
                .filter(a => a.streamer === m.streamer && new Date(a.time) >= new Date(m.startTime))
                .reduce((s, a) => s + (parseFloat(a.amount) || 0), 0);
            const cur = init + donated + adjusted;
            const pct = target > 0 ? Math.min((cur / target) * 100, 100) : 0;
            const done = pct >= 100 || m.status === 'completed';
            const emoji = this.emojis[m.streamer] || '';
            return `<div class="gm-card"><div class="gm-bar${done ? ' done' : ''}" style="width:${pct}%"></div><div class="gm-info"><span class="gm-l"><span>${emoji}</span><span>${m.streamer}</span></span><span class="gm-r"><span>${fmt(cur)}/${fmt(target)}</span><span class="gm-pct${done ? ' done' : ''}">${Math.round(pct)}%</span></span></div></div>`;
        }).join('');
    }

    updateDisplay() {
        const contentEl = document.getElementById('donor-content');
        contentEl.style.color = '';

        // ì¹´ì¹´ì˜¤ë±…í¬ ê³„ì¢Œ ì •ë³´ í‘œì‹œ ì„¤ì •
        const showKakaoBank = this.settings.showKakaoBank !== false;
        console.log('ğŸ¦ [ë””ë²„ê¹…] showKakaoBank ì„¤ì •ê°’:', this.settings.showKakaoBank, 'â†’ ìµœì¢…ê°’:', showKakaoBank);
        
        // ì¹´ì¹´ì˜¤ë±…í¬ í¬ê¸° ì„¤ì • (ì ˆëŒ€ê°’ px)
        const kakaoBankSize = this.settings.kakaoBankSize || 18;

        // í›„ì›ì ë¦¬ìŠ¤íŠ¸ í¬ê¸° (px)
        const donorListFontSize = parseInt(this.settings['overlay-font-size']) || 24;
        
        // ì¹´ì¹´ì˜¤ë±…í¬ ì¤„ê°„ê²© ì„¤ì •
        const kakaoBankLineHeight = this.settings.kakaoBankLineHeight || 1.2;
        
        if (!this.donations || this.donations.length === 0) {
            let content = '';

            // ì¹´ì¹´ì˜¤ë±…í¬ ì •ë³´ ì¶”ê°€ - DOM ì§ì ‘ ìƒì„±
            if (showKakaoBank) {
                contentEl.innerHTML = '';

                // ì¹´ì¹´ì˜¤ë±…í¬ ì¤„ê°„ê²© ì„¤ì •ê°’ ì ìš©
                const bankLineHeight = this.settings.kakaoBankLineHeight || 1.0;
                const textLineHeight = parseFloat(this.settings['overlay-line-height']) || 1.5;

                // ì¹´ì¹´ì˜¤ë±…í¬ DOM ìƒì„±
                const bankDiv = document.createElement('div');
                bankDiv.className = 'kakao-bank-info';
                bankDiv.style.cssText = `font-size: ${kakaoBankSize}px; line-height: ${bankLineHeight} !important; margin: 0 !important; padding: 0 !important;`;

                const bankInfo = document.createElement('div');
                bankInfo.textContent = this.settings.kakaoBankAccount || 'ì¹´ì¹´ì˜¤ë±…í¬ 3333-25-7378436 ì—„ì‚¼O';
                bankInfo.style.cssText = `margin: 0 !important; padding: 0 !important; line-height: ${bankLineHeight} !important; font-weight: bold; color: #FFEB3B;`;

                bankDiv.appendChild(bankInfo);
                
                // í…ìŠ¤íŠ¸ DOM ìƒì„± - ì¤„ê°„ê²© ì„¤ì •ê°’ ì ìš©
                const textColor = this.settings['overlay-text-color'] || '#ffffff';
                const textDiv = document.createElement('div');
                textDiv.className = 'donor-text';
                textDiv.textContent = content;
                textDiv.style.cssText = `font-size: ${donorListFontSize}px !important; line-height: ${textLineHeight} !important; margin: 0 !important; padding: 0 !important; color: ${textColor} !important;`;

                contentEl.appendChild(bankDiv);
                contentEl.appendChild(textDiv);
            } else {
                contentEl.textContent = content;
            }

            contentEl.className = 'no-data';
            return;
        }

        // í›„ì›ìë³„ ì´ì•¡ ê³„ì‚° (ê³„ì¢Œ + ìŠˆí¼ì±— ì˜µì…˜) - ì •ì‚°ìš”ì•½ê³¼ ë™ì¼í•œ ë¡œì§
        const donorAccountTotals = {};
        
        // ìŠˆí¼ì±— í¬í•¨ ì˜µì…˜ í™•ì¸ (ì„œë²„ ì„¤ì • ìš°ì„ , ì—†ìœ¼ë©´ ë¡œì»¬ ì„¤ì •)
        const includeSuperchat = this.settings.includeSuperchat !== undefined ? 
            this.settings.includeSuperchat : (localStorage.getItem('include-superchat') === 'true');
            
        // ğŸ” ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€
        console.log('ğŸ” [ë””ë²„ê¹…] ì „ì²´ í›„ì› ë°ì´í„°:', this.donations?.length || 0, 'ê±´');
        console.log('ğŸ” [ë””ë²„ê¹…] includeSuperchat:', includeSuperchat);
            
        this.donations.forEach((d, index) => {
            const amount = parseFloat(d.amount) || 0;
            // ğŸ”¥ íˆ¬ë„¤ì´ì…˜ì€ ì˜¤ë²„ë ˆì´ì—ì„œ ì™„ì „ ì œì™¸, ê³„ì¢Œì´ì²´ë§Œ í‘œì‹œ
            const shouldInclude = d.type === 'ê³„ì¢Œ' || (includeSuperchat && d.type === 'ìŠˆí¼ì±—');
            // íˆ¬ë„¤ì´ì…˜ íƒ€ì…ì€ ë¬´ì¡°ê±´ ì œì™¸
            if (d.type === 'íˆ¬ë„¤ì´ì…˜') {
                console.log(`ğŸš« íˆ¬ë„¤ì´ì…˜ ì œì™¸: ${d.donor}ë‹˜ ${amount}ë§Œì›`);
                return;
            }
            
            // ğŸ” ê° ë°ì´í„° ë””ë²„ê¹…
            console.log(`ğŸ” [${index+1}] donor: "${d.donor}", type: "${d.type}", amount: ${amount}, shouldInclude: ${shouldInclude}`);
            
            if (shouldInclude) {
                // ìŠ¤íŠ¸ë¦¬ë¨¸ë³„ ì¡°ì •ì€ ì œì™¸, í›„ì›ìë³„ ì¡°ì •ì€ í¬í•¨
                if (d.donor.includes('ì¡°ì •(') && d.streamer !== 'í›„ì›ìì¡°ì •') {
                    // ìŠ¤íŠ¸ë¦¬ë¨¸ë³„ ì¡°ì • â†’ ì œì™¸
                    return;
                }
                
                // í›„ì›ìëª…ì—ì„œ (ì¡°ì •+ê¸ˆì•¡) ë¶€ë¶„ ì œê±°
                let cleanDonorName = d.donor;
                if (cleanDonorName.includes('(ì¡°ì •')) {
                    cleanDonorName = cleanDonorName.replace(/\(ì¡°ì •[^)]*\)/g, '');
                }
                
                // ê³„ì¢Œí›„ì›ìë‹˜ì€ ê·¸ëŒ€ë¡œ í‘œì‹œ (íŠ¹ë³„ ì²˜ë¦¬)
                if (cleanDonorName === 'ê³„ì¢Œí›„ì›ìë‹˜' || cleanDonorName === 'ê³„ì¢Œí›„ì›ì') {
                    cleanDonorName = 'ê³„ì¢Œí›„ì›ìë‹˜';
                }
                
                donorAccountTotals[cleanDonorName] = (donorAccountTotals[cleanDonorName] || 0) + amount;
            }
        });

        // ê·¸ë£¹í™” ì„ê³„ê°’ ë¡œë“œ (ì„œë²„ ì„¤ì • ìš°ì„ , ì—†ìœ¼ë©´ ë¡œì»¬ ì„¤ì •)
        const groupThreshold = this.settings.groupThreshold || parseInt(localStorage.getItem('group-threshold') || '2');
        
        // ê¸ˆì•¡ë³„ ê·¸ë£¹í™”
        const amountGroups = {};
        for (const donor in donorAccountTotals) {
            const amount = donorAccountTotals[donor];
            if (amount > 0) {
                if (!amountGroups[amount]) { 
                    amountGroups[amount] = []; 
                }
                amountGroups[amount].push(donor);
            }
        }

        // ğŸ” ê³„ì‚° ê²°ê³¼ ë””ë²„ê¹…
        console.log('ğŸ” [ê³„ì‚°ê²°ê³¼] donorAccountTotals:', donorAccountTotals);
        console.log('ğŸ” [ê³„ì‚°ê²°ê³¼] amountGroups:', amountGroups);
        
        // ì†Œì•¡ í•„í„°ë§ (0.1ë§Œì› ë¯¸ë§Œ ì œì™¸)
        const filteredGroups = Object.entries(amountGroups).filter(([amount]) => parseFloat(amount) >= 0.1);
        const sortedGroups = filteredGroups.sort((a, b) => parseFloat(b[0]) - parseFloat(a[0]));
        
        console.log('ğŸ” [ìµœì¢…ê²°ê³¼] sortedGroups:', sortedGroups);
        console.log('ğŸ” [ìµœì¢…ê²°ê³¼] í‘œì‹œí•  ê·¸ë£¹ ìˆ˜:', sortedGroups.length);
        
        if (sortedGroups.length === 0) {
            let content = '';

            // ì¹´ì¹´ì˜¤ë±…í¬ ì •ë³´ ì¶”ê°€
            if (showKakaoBank) {
                contentEl.innerHTML = '';

                // ì¹´ì¹´ì˜¤ë±…í¬ ì¤„ê°„ê²© ì„¤ì •ê°’ ì ìš©
                const bankLineHeight = this.settings.kakaoBankLineHeight || 1.0;
                const textLineHeight = parseFloat(this.settings['overlay-line-height']) || 1.5;

                // ì¹´ì¹´ì˜¤ë±…í¬ DOM ìƒì„±
                const bankDiv = document.createElement('div');
                bankDiv.className = 'kakao-bank-info';
                bankDiv.style.cssText = `font-size: ${kakaoBankSize}px; line-height: ${bankLineHeight} !important; margin: 0 !important; padding: 0 !important;`;

                const bankInfo = document.createElement('div');
                bankInfo.textContent = this.settings.kakaoBankAccount || 'ì¹´ì¹´ì˜¤ë±…í¬ 3333-25-7378436 ì—„ì‚¼O';
                bankInfo.style.cssText = `margin: 0 !important; padding: 0 !important; line-height: ${bankLineHeight} !important; font-weight: bold; color: #FFEB3B;`;

                bankDiv.appendChild(bankInfo);
                
                // í…ìŠ¤íŠ¸ DOM ìƒì„± - ì¤„ê°„ê²© ì„¤ì •ê°’ ì ìš©
                const textColor = this.settings['overlay-text-color'] || '#ffffff';
                const textDiv = document.createElement('div');
                textDiv.className = 'donor-text';
                textDiv.textContent = content;
                textDiv.style.cssText = `font-size: ${donorListFontSize}px !important; line-height: ${textLineHeight} !important; margin: 0 !important; padding: 0 !important; color: ${textColor} !important;`;

                contentEl.appendChild(bankDiv);
                contentEl.appendChild(textDiv);
            } else {
                contentEl.textContent = content;
            }

            contentEl.className = 'no-data';
            return;
        }
        
        // ë¦¬ìŠ¤íŠ¸ ë‹¨ìœ„ ì¤„ë°”ê¿ˆì„ ìœ„í•´ ê° í•­ëª©ì„ spanìœ¼ë¡œ ê°ì‹¸ê¸°
        const donorItems = [];
        sortedGroups.forEach(([amount, donors]) => {
            const numAmount = parseFloat(amount);
            const amountStr = `${numAmount % 1 === 0 ? Math.floor(numAmount) : numAmount.toFixed(1)}`;
            if (donors.length >= groupThreshold) {
                // ê·¸ë£¹í™”ëœ í›„ì›ìë“¤ì€ í•˜ë‚˜ì˜ í•­ëª©ìœ¼ë¡œ
                donorItems.push(`<span class="donor-item">${donors.map(d => d + 'ë‹˜').join(', ')} ${amountStr}</span>`);
            } else {
                // ê°œë³„ í›„ì›ìëŠ” ê°ê° í•­ëª©ìœ¼ë¡œ
                donors.forEach(d => {
                    donorItems.push(`<span class="donor-item">${d}ë‹˜ ${amountStr}</span>`);
                });
            }
        });
        const donorTotalText = donorItems.join(' ');
        
        // í›„ì›ì ëª©ë¡ë§Œ í‘œì‹œ
        let finalText = donorTotalText || '';

        // ì¹´ì¹´ì˜¤ë±…í¬ ì •ë³´ ì¶”ê°€ (í›„ì›ìê°€ ìˆì„ ë•Œ)
        if (showKakaoBank) {
            // DOM ìš”ì†Œ ì§ì ‘ ìƒì„±ìœ¼ë¡œ ì™„ì „í•œ ì œì–´
            contentEl.innerHTML = '';

            // ì¹´ì¹´ì˜¤ë±…í¬ ì¤„ê°„ê²© ì„¤ì •ê°’ ì ìš©
            const bankLineHeight = this.settings.kakaoBankLineHeight || 1.0;

            // ì¹´ì¹´ì˜¤ë±…í¬ ì •ë³´ DOM ìƒì„±
            const bankDiv = document.createElement('div');
            bankDiv.style.cssText = `font-size: ${kakaoBankSize}px; line-height: ${bankLineHeight} !important; margin: 0 !important; padding: 0 !important; display: block !important;`;
            bankDiv.className = 'kakao-bank-info';

            const bankInfo = document.createElement('div');
            bankInfo.textContent = this.settings.kakaoBankAccount || 'ì¹´ì¹´ì˜¤ë±…í¬ 3333-25-7378436 ì—„ì‚¼O';
            bankInfo.style.cssText = `margin: 0 !important; padding: 0 !important; line-height: ${bankLineHeight} !important; font-weight: bold; color: #FFEB3B;`;

            bankDiv.appendChild(bankInfo);
            contentEl.appendChild(bankDiv);
            
            // í›„ì›ì í…ìŠ¤íŠ¸ ì¤„ê°„ê²© ì„¤ì •ê°’ ì ìš© 
            const textLineHeight = parseFloat(this.settings['overlay-line-height']) || 1.5;
            
            // í›„ì›ì í…ìŠ¤íŠ¸ - ë¦¬ìŠ¤íŠ¸ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ
            const textColor = this.settings['overlay-text-color'] || '#ffffff';
            const textDiv = document.createElement('div');
            textDiv.className = 'donor-text';
            textDiv.innerHTML = finalText;
            textDiv.style.cssText = `font-size: ${donorListFontSize}px !important; line-height: ${textLineHeight} !important; margin: 0 !important; padding: 0 !important; display: block !important; color: ${textColor} !important;`;

            contentEl.appendChild(textDiv);
        } else {
            const textColor = this.settings['overlay-text-color'] || '#ffffff';
            contentEl.innerHTML = `<div style="font-size: ${donorListFontSize}px; line-height: 1.2; color: ${textColor} !important;">${finalText}</div>`;
        }
        contentEl.className = 'donor-content';
        
        console.log('ğŸ“Š í™”ë©´ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', sortedGroups.length, 'ê°œ ê·¸ë£¹ì˜ í›„ì›ì');
    }
    
    showError(message) {
        const contentEl = document.getElementById('donor-content');
        contentEl.textContent = message;
        contentEl.className = 'no-data';
        contentEl.style.color = '';
    }
    
    flashUpdate() {
        // ëª¨ë°”ì¼ì—ì„œ ë°°í„°ë¦¬ ì ˆì•½ì„ ìœ„í•´ flashUpdate ë¹„í™œì„±í™”
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isSmallScreen = window.innerWidth <= 768;
        
        if (isMobile || isSmallScreen) {
            console.log('ğŸ“± ëª¨ë°”ì¼/ì†Œí™”ë©´ ê°ì§€: flashUpdate ë¹„í™œì„±í™”');
            return;
        }
        
        const container = document.querySelector('.overlay-container');
        if (container) {
            container.style.opacity = '0.7';
            setTimeout(() => {
                container.style.opacity = '1';
            }, 200);
        }
    }
    
    setupKeyboardControls() {
        document.addEventListener('keydown', (e) => {
            if (e.altKey) {
                switch(e.key) {
                    case '1': // Alt+1: ì™¼ìª½ ì •ë ¬
                        this.settings['overlay-text-align'] = 'left';
                        this.applySettings();
                        this.updateDisplay();
                        console.log('ì •ë ¬: ì™¼ìª½');
                        break;
                    case '2': // Alt+2: ê°€ìš´ë° ì •ë ¬
                        this.settings['overlay-text-align'] = 'center';
                        this.applySettings();
                        this.updateDisplay();
                        console.log('ì •ë ¬: ê°€ìš´ë°');
                        break;
                    case '3': // Alt+3: ì˜¤ë¥¸ìª½ ì •ë ¬
                        this.settings['overlay-text-align'] = 'right';
                        this.applySettings();
                        this.updateDisplay();
                        console.log('ì •ë ¬: ì˜¤ë¥¸ìª½');
                        break;
                    case '=': // Alt+=: í°íŠ¸ í¬ê¸° ì¦ê°€
                        this.settings['overlay-font-size'] = Math.min(50, (this.settings['overlay-font-size'] || 18) + 2);
                        this.applySettings();
                        this.updateDisplay();
                        console.log('í°íŠ¸ í¬ê¸°:', this.settings['overlay-font-size']);
                        break;
                    case '-': // Alt+-: í°íŠ¸ í¬ê¸° ê°ì†Œ
                        this.settings['overlay-font-size'] = Math.max(10, (this.settings['overlay-font-size'] || 18) - 2);
                        this.applySettings();
                        this.updateDisplay();
                        console.log('í°íŠ¸ í¬ê¸°:', this.settings['overlay-font-size']);
                        break;
                }
                e.preventDefault();
            }
        });
    }
    
    // ì¹´ì¹´ì˜¤ë±…í¬ ë³´í˜¸ - ì„¤ì •ì— ë”°ë¼ ë™ì‘
    forceKakaoBankProtection() {
        // showKakaoBank ì„¤ì •ì´ falseë©´ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
        if (this.settings.showKakaoBank === false) {
            return;
        }

        const contentEl = document.getElementById('donor-content');
        if (!contentEl) return;

        const currentHTML = contentEl.innerHTML;

        // ì¹´ì¹´ì˜¤ë±…í¬ ì •ë³´ê°€ ì—†ìœ¼ë©´ ê°•ì œ ì¶”ê°€
        const accountText = this.settings.kakaoBankAccount || 'ì¹´ì¹´ì˜¤ë±…í¬ 3333-25-7378436 ì—„ì‚¼O';
        if (!currentHTML.includes(accountText)) {
            console.log('ğŸš¨ ì¹´ì¹´ì˜¤ë±…í¬ ì •ë³´ ì—†ìŒ ê°ì§€ - ê°•ì œ ë³µêµ¬');

            // ê¸°ì¡´ í…ìŠ¤íŠ¸ ë³´ì¡´í•˜ë©´ì„œ ì¹´ì¹´ì˜¤ë±…í¬ë§Œ ì¶”ê°€
            const existingText = contentEl.textContent || '';

            contentEl.innerHTML = '';

            // ì¹´ì¹´ì˜¤ë±…í¬ DOM ìƒì„±
            const bankDiv = document.createElement('div');
            bankDiv.className = 'kakao-bank-info';
            bankDiv.style.cssText = 'font-size: 18px; line-height: 1.2 !important; margin: 0 !important; padding: 0 !important;';

            const bankInfo = document.createElement('div');
            bankInfo.textContent = accountText;
            bankInfo.style.cssText = 'margin: 0 !important; padding: 0 !important; line-height: 1.2 !important; font-weight: bold; color: #FFEB3B;';

            bankDiv.appendChild(bankInfo);

            // í…ìŠ¤íŠ¸ DOM ìƒì„±
            const textColor = this.settings['overlay-text-color'] || '#ffffff';
            const textDiv = document.createElement('div');
            textDiv.className = 'donor-text';
            textDiv.textContent = existingText.replace(accountText, '').trim() || '';
            textDiv.style.cssText = `line-height: 1.5 !important; margin: 0 !important; padding: 0 !important; color: ${textColor} !important;`;

            contentEl.appendChild(bankDiv);
            contentEl.appendChild(textDiv);
        }
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œì‘ - Cache Buster v2024083009
document.addEventListener('DOMContentLoaded', () => {
    console.log('ğŸ¬ ì‹¤ì‹œê°„ í›„ì›ì ì˜¤ë²„ë ˆì´ ì‹œì‘ - v2024082001 DOMì§ì ‘ì¡°ì‘ë°©ì‹');
    console.log('ğŸ”§ ì¹´ì¹´ì˜¤ë±…í¬ ê°„ê²© ì™„ì „ê³ ì • - bríƒœê·¸ ì™„ì „ë°°ì œ DOMìƒì„±ë°©ì‹ ì ìš©');
    const overlay = new RealtimeDonorOverlay();
    
    // ğŸ”¥ ì¹´ì¹´ì˜¤ë±…í¬ ê°•ì œ ë³´í˜¸ - 10ì´ˆë§ˆë‹¤ ê°ì‹œ (ë°œì—´ ë°©ì§€ ê°•í™”)
    overlay.kakaoBankTimer = setInterval(() => {
        if (!overlay.batterySaveMode) {
            overlay.forceKakaoBankProtection();
        }
    }, 10000);
});
</script>

</body>
</html>
