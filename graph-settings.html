<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“Š ê·¸ë˜í”„ ì¡°ì •ëª¨ë“œ</title>

<!-- Socket.IO for Real-time -->
<script src="/socket.io/socket.io.js"></script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
    background: #f8f9fa;
    min-height: 100vh;
    color: #333;
    padding: 20px;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
}

.header {
    background: #007bff;
    color: white;
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    margin-bottom: 30px;
    box-shadow: 0 4px 12px rgba(0,123,255,0.3);
}

.header h1 {
    margin: 0;
    font-size: 28px;
}

.header p {
    margin: 8px 0 0 0;
    opacity: 0.9;
    font-size: 16px;
}

.tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

.tab-button {
    padding: 12px 20px;
    border: none;
    background: #6c757d;
    color: white;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.3s;
}

.tab-button.active {
    background: #007bff;
    box-shadow: 0 3px 8px rgba(0,123,255,0.4);
}

.tab-button:hover:not(.active) {
    background: #5a6268;
}

.tab-content {
    display: none;
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

.tab-content.active {
    display: block;
}

.section {
    margin-bottom: 25px;
    padding: 20px;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    background: #f8f9fa;
}

.section h3 {
    color: #495057;
    margin-bottom: 15px;
    font-size: 18px;
}

.form-group {
    margin-bottom: 15px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #495057;
}

.form-input, .form-select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
}

.form-input:focus, .form-select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
}

.grid {
    display: grid;
    gap: 15px;
    margin-bottom: 20px;
}

.grid-2 { grid-template-columns: 1fr 1fr; }
.grid-3 { grid-template-columns: 1fr 1fr 1fr; }

.slider-group {
    display: flex;
    align-items: center;
    gap: 15px;
}

.slider-label {
    min-width: 120px;
    font-weight: 600;
    color: #495057;
}

.slider {
    flex: 1;
    height: 6px;
    border-radius: 3px;
    background: #ddd;
    outline: none;
    -webkit-appearance: none;
}

.slider::-webkit-slider-thumb {
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #007bff;
    cursor: pointer;
}

.slider-value {
    min-width: 60px;
    font-weight: 600;
    color: #007bff;
}

.color-input {
    width: 60px;
    height: 40px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

.checkbox-group {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 0;
}

.checkbox {
    transform: scale(1.3);
    cursor: pointer;
}

.buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-primary {
    background: #007bff;
    color: white;
}

.btn-primary:hover {
    background: #0056b3;
}

.btn-success {
    background: #28a745;
    color: white;
}

.btn-success:hover {
    background: #1e7e34;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #545b62;
}

.status {
    padding: 12px;
    border-radius: 6px;
    margin: 10px 0;
    font-weight: 500;
}

.status-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.status-error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.overlay-preview {
    margin-top: 20px;
    padding: 15px;
    border: 2px dashed #ddd;
    border-radius: 8px;
    text-align: center;
    color: #666;
}

@media (max-width: 768px) {
    .grid-2, .grid-3 { grid-template-columns: 1fr; }
    .slider-group { flex-direction: column; align-items: stretch; }
    .tabs { flex-direction: column; }
    .buttons { flex-direction: column; }
}
</style>
</head>

<body>
<div class="container">
    <!-- í—¤ë” -->
    <div class="header">
        <h1>ğŸ“Š ê·¸ë˜í”„ ì¡°ì •ëª¨ë“œ</h1>
        <p>í‡´ê·¼ë¯¸ì…˜ ê·¸ë˜í”„ & ì´ì•¡ëª©í‘œ ê·¸ë˜í”„ ì„¤ì • ì „ìš©</p>
    </div>

    <!-- íƒ­ ë©”ë‰´ -->
    <div class="tabs">
        <button class="tab-button active" onclick="switchTab('mission')">ğŸ¯ í‡´ê·¼ë¯¸ì…˜ ê·¸ë˜í”„</button>
        <button class="tab-button" onclick="switchTab('total')">ğŸ’° ì´ì•¡ëª©í‘œ ê·¸ë˜í”„</button>
    </div>

    <!-- í‡´ê·¼ë¯¸ì…˜ ê·¸ë˜í”„ ì„¤ì • -->
    <div class="tab-content active" id="mission-tab">
        <div class="section">
            <h3>ğŸ¯ í‡´ê·¼ë¯¸ì…˜ ê·¸ë˜í”„ ì˜¤ë²„ë ˆì´ ì„¤ì •</h3>
            
            <!-- ë°°ê²½ ì„¤ì • -->
            <div class="grid grid-2">
                <div class="form-group">
                    <label class="form-label">ë°°ê²½ íˆ¬ëª…ë„</label>
                    <div class="slider-group">
                        <span class="slider-label">íˆ¬ëª…</span>
                        <input type="range" class="slider" id="mission-bg-opacity" min="0" max="100" value="85">
                        <span class="slider-value" id="mission-bg-opacity-value">85%</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ë°°ê²½ ìƒ‰ìƒ</label>
                    <input type="color" class="color-input" id="mission-bg-color" value="#000000">
                </div>
            </div>

            <!-- í…ìŠ¤íŠ¸ í…Œë‘ë¦¬ -->
            <div class="grid grid-2">
                <div class="form-group">
                    <label class="form-label">í…ìŠ¤íŠ¸ í…Œë‘ë¦¬ ë‘ê»˜</label>
                    <div class="slider-group">
                        <span class="slider-label">ì—†ìŒ</span>
                        <input type="range" class="slider" id="mission-text-outline-width" min="0" max="5" value="1">
                        <span class="slider-value" id="mission-text-outline-width-value">1px</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">í…ìŠ¤íŠ¸ í…Œë‘ë¦¬ ìƒ‰ìƒ</label>
                    <input type="color" class="color-input" id="mission-text-outline-color" value="#000000">
                </div>
            </div>

            <!-- í¬ê¸° ì„¤ì • -->
            <div class="grid grid-3">
                <div class="form-group">
                    <label class="form-label">ì œëª© í¬ê¸°</label>
                    <div class="slider-group">
                        <span class="slider-label">ì‘ê²Œ</span>
                        <input type="range" class="slider" id="mission-title-size" min="16" max="32" value="20">
                        <span class="slider-value" id="mission-title-size-value">20px</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ìˆ«ì í¬ê¸°</label>
                    <div class="slider-group">
                        <span class="slider-label">ì‘ê²Œ</span>
                        <input type="range" class="slider" id="mission-stats-size" min="12" max="24" value="16">
                        <span class="slider-value" id="mission-stats-size-value">16px</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ì§„í–‰ë°” ë†’ì´</label>
                    <div class="slider-group">
                        <span class="slider-label">ë‚®ê²Œ</span>
                        <input type="range" class="slider" id="mission-progress-height" min="15" max="35" value="20">
                        <span class="slider-value" id="mission-progress-height-value">20px</span>
                    </div>
                </div>
            </div>

            <!-- ì§„í–‰ë°” í…ìŠ¤íŠ¸ ì„¤ì • -->
            <div class="section" style="background: #e8f4fd; border-color: #007bff;">
                <h4 style="color: #007bff; margin-bottom: 15px;">ğŸ“‹ ì§„í–‰ë°” í…ìŠ¤íŠ¸ ì˜µì…˜</h4>
                <div class="grid grid-2">
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox" id="mission-show-progress-text" checked>
                        <label>ì§„í–‰ë°” ë‚´ë¶€ í…ìŠ¤íŠ¸ í‘œì‹œ</label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">í…ìŠ¤íŠ¸ í¬ê¸°</label>
                        <div class="slider-group">
                            <span class="slider-label">ì‘ê²Œ</span>
                            <input type="range" class="slider" id="mission-progress-text-size" min="10" max="16" value="12">
                            <span class="slider-value" id="mission-progress-text-size-value">12px</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">í…ìŠ¤íŠ¸ ìƒ‰ìƒ</label>
                    <input type="color" class="color-input" id="mission-progress-text-color" value="#ffffff">
                </div>
            </div>

            <div class="buttons">
                <button class="btn btn-success" onclick="saveMissionSettings()">âœ… ì ìš©</button>
                <button class="btn btn-secondary" onclick="resetMissionSettings()">ğŸ”„ ê¸°ë³¸ê°’</button>
                <button class="btn btn-primary" onclick="openMissionOverlay()">ğŸ”— ì˜¤ë²„ë ˆì´ ì—´ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì´ì•¡ëª©í‘œ ê·¸ë˜í”„ ì„¤ì • -->
    <div class="tab-content" id="total-tab">
        <div class="section">
            <h3>ğŸ’° ì´ì•¡ëª©í‘œ ê·¸ë˜í”„ ì˜¤ë²„ë ˆì´ ì„¤ì •</h3>
            
            <!-- ëª©í‘œ ì„¤ì • -->
            <div class="grid grid-2">
                <div class="form-group">
                    <label class="form-label">ì¼ì¼ ëª©í‘œì•¡ (ë§Œì›)</label>
                    <input type="number" class="form-input" id="daily-goal-target" placeholder="ì˜ˆ: 100">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" class="checkbox" id="auto-extend-enabled">
                    <label>ìë™ ëª©í‘œ ì¶”ê°€ (+<input type="number" id="extend-amount" value="50" style="width: 60px; text-align: center; border: 1px solid #ddd; border-radius: 4px;">ë§Œì›)</label>
                </div>
            </div>

            <!-- ë°°ê²½ ì„¤ì • -->
            <div class="grid grid-2">
                <div class="form-group">
                    <label class="form-label">ë°°ê²½ íˆ¬ëª…ë„</label>
                    <div class="slider-group">
                        <span class="slider-label">íˆ¬ëª…</span>
                        <input type="range" class="slider" id="total-bg-opacity" min="0" max="100" value="0">
                        <span class="slider-value" id="total-bg-opacity-value">0%</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ë°°ê²½ ìƒ‰ìƒ</label>
                    <input type="color" class="color-input" id="total-bg-color" value="#000000">
                </div>
            </div>

            <!-- í…ìŠ¤íŠ¸ ì„¤ì • -->
            <div class="grid grid-2">
                <div class="form-group">
                    <label class="form-label">í…ìŠ¤íŠ¸ í…Œë‘ë¦¬ ë‘ê»˜</label>
                    <div class="slider-group">
                        <span class="slider-label">ì—†ìŒ</span>
                        <input type="range" class="slider" id="total-text-outline-width" min="0" max="5" value="1">
                        <span class="slider-value" id="total-text-outline-width-value">1px</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">í…ìŠ¤íŠ¸ í…Œë‘ë¦¬ ìƒ‰ìƒ</label>
                    <input type="color" class="color-input" id="total-text-outline-color" value="#000000">
                </div>
            </div>

            <!-- í‘œì‹œ ì˜µì…˜ -->
            <div class="section" style="background: #e8f4fd; border-color: #007bff;">
                <h4 style="color: #007bff; margin-bottom: 15px;">ğŸ“‹ í‘œì‹œ ì˜µì…˜</h4>
                <div class="grid grid-2">
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox" id="total-show-top-stats" checked>
                        <label>ì§„í–‰ë°” ìœ„ ê¸€ì í‘œì‹œ</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox" id="total-text-switch-enabled">
                        <label>ì§„í–‰ë°” í…ìŠ¤íŠ¸ ìë™ ì „í™˜</label>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label class="form-label">ì „í™˜ ê°„ê²©</label>
                    <div class="slider-group">
                        <span class="slider-label">ë¹ ë¥´ê²Œ</span>
                        <input type="range" class="slider" id="total-text-switch-interval" min="3" max="15" value="5" disabled>
                        <span class="slider-value" id="total-text-switch-interval-value">5ì´ˆ</span>
                    </div>
                </div>
            </div>

            <!-- í¬ê¸° ì„¤ì • -->
            <div class="grid grid-3">
                <div class="form-group">
                    <label class="form-label">ì œëª© í¬ê¸°</label>
                    <div class="slider-group">
                        <span class="slider-label">ì‘ê²Œ</span>
                        <input type="range" class="slider" id="total-title-size" min="18" max="36" value="24">
                        <span class="slider-value" id="total-title-size-value">24px</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ìˆ«ì í¬ê¸°</label>
                    <div class="slider-group">
                        <span class="slider-label">ì‘ê²Œ</span>
                        <input type="range" class="slider" id="total-stats-size" min="16" max="28" value="20">
                        <span class="slider-value" id="total-stats-size-value">20px</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ì§„í–‰ë°” ë†’ì´</label>
                    <div class="slider-group">
                        <span class="slider-label">ë‚®ê²Œ</span>
                        <input type="range" class="slider" id="total-progress-height" min="20" max="50" value="30">
                        <span class="slider-value" id="total-progress-height-value">30px</span>
                    </div>
                </div>
            </div>

            <div class="buttons">
                <button class="btn btn-success" onclick="saveTotalSettings()">âœ… ì ìš©</button>
                <button class="btn btn-secondary" onclick="resetTotalSettings()">ğŸ”„ ê¸°ë³¸ê°’</button>
                <button class="btn btn-primary" onclick="openTotalOverlay()">ğŸ”— ì˜¤ë²„ë ˆì´ ì—´ê¸°</button>
            </div>
            
            <!-- ë¡œì»¬ ì„¤ì • ê´€ë¦¬ -->
            <div class="section" style="background: #fff3cd; border-color: #ffc107; margin-top: 20px;">
                <h4 style="color: #856404; margin-bottom: 15px;">ğŸ’¾ ë¡œì»¬ ì„¤ì • ê´€ë¦¬</h4>
                <p style="color: #856404; font-size: 14px; margin-bottom: 15px;">
                    ì„¤ì •ì´ ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ì–´ ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€ë©ë‹ˆë‹¤.
                </p>
                <div class="buttons">
                    <button class="btn btn-secondary" onclick="clearLocalSettings()">ğŸ—‘ï¸ ë¡œì»¬ ì„¤ì • ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒíƒœ ë©”ì‹œì§€ -->
    <div id="status-message"></div>

    <!-- í”„ë¦¬ë·° ì˜ì—­ -->
    <div class="overlay-preview" id="preview-area">
        <p>ğŸ’¡ ì„¤ì •ì„ ë³€ê²½í•˜ê³  "ì ìš©" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì˜¤ë²„ë ˆì´ì— ë°˜ì˜ë©ë‹ˆë‹¤</p>
        <p>ğŸ”— ì˜¤ë²„ë ˆì´ ì—´ê¸° ë²„íŠ¼ìœ¼ë¡œ ì‹¤ì œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
    </div>
</div>

<script>
// ì „ì—­ ë³€ìˆ˜
let socket = null;

// Socket.IO ì—°ê²°
function initSocket() {
    socket = io({
        transports: ['websocket', 'polling'],
        timeout: 20000,
        forceNew: true
    });

    socket.on('connect', () => {
        console.log('ğŸ”— ê·¸ë˜í”„ ì¡°ì •ëª¨ë“œ ì„œë²„ ì—°ê²° ì„±ê³µ');
        loadCurrentSettings();
    });

    socket.on('disconnect', () => {
        console.log('âŒ ì„œë²„ ì—°ê²° ëŠê¹€');
    });

    socket.on('settingsUpdate', (settings) => {
        console.log('âš™ï¸ ì„¤ì • ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :', settings);
    });
}

// íƒ­ ì „í™˜
function switchTab(tabName) {
    // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì½˜í…ì¸  ì´ˆê¸°í™”
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    // ì„ íƒëœ íƒ­ í™œì„±í™”
    event.target.classList.add('active');
    document.getElementById(tabName + '-tab').classList.add('active');
}

// ìŠ¬ë¼ì´ë” ê°’ ì—…ë°ì´íŠ¸
function initSliders() {
    const sliders = document.querySelectorAll('.slider');
    sliders.forEach(slider => {
        const valueElement = document.getElementById(slider.id + '-value');
        if (valueElement) {
            // ì´ˆê¸°ê°’ ì„¤ì •
            updateSliderValue(slider);
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            slider.addEventListener('input', () => updateSliderValue(slider));
        }
    });
    
    // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
    document.getElementById('auto-extend-enabled').addEventListener('change', function() {
        document.getElementById('extend-amount').disabled = !this.checked;
    });
    
    document.getElementById('total-text-switch-enabled').addEventListener('change', function() {
        document.getElementById('total-text-switch-interval').disabled = !this.checked;
    });
}

function updateSliderValue(slider) {
    const valueElement = document.getElementById(slider.id + '-value');
    if (valueElement) {
        const suffix = slider.id.includes('opacity') ? '%' : 
                      slider.id.includes('interval') ? 'ì´ˆ' : 'px';
        valueElement.textContent = slider.value + suffix;
    }
}

// ë¡œì»¬ ì„¤ì • ì €ì¥
function saveLocalSettings() {
    const localSettings = {
        // í‡´ê·¼ë¯¸ì…˜ ê·¸ë˜í”„ ì„¤ì •
        'mission-bg-opacity': document.getElementById('mission-bg-opacity').value,
        'mission-bg-color': document.getElementById('mission-bg-color').value,
        'mission-text-outline-width': document.getElementById('mission-text-outline-width').value,
        'mission-text-outline-color': document.getElementById('mission-text-outline-color').value,
        'mission-title-size': document.getElementById('mission-title-size').value,
        'mission-stats-size': document.getElementById('mission-stats-size').value,
        'mission-progress-height': document.getElementById('mission-progress-height').value,
        'mission-show-progress-text': document.getElementById('mission-show-progress-text').checked,
        'mission-progress-text-size': document.getElementById('mission-progress-text-size').value,
        'mission-progress-text-color': document.getElementById('mission-progress-text-color').value,
        
        // ì´ì•¡ëª©í‘œ ê·¸ë˜í”„ ì„¤ì •
        'daily-goal-target': document.getElementById('daily-goal-target').value,
        'auto-extend-enabled': document.getElementById('auto-extend-enabled').checked,
        'extend-amount': document.getElementById('extend-amount').value,
        'total-bg-opacity': document.getElementById('total-bg-opacity').value,
        'total-bg-color': document.getElementById('total-bg-color').value,
        'total-text-outline-width': document.getElementById('total-text-outline-width').value,
        'total-text-outline-color': document.getElementById('total-text-outline-color').value,
        'total-show-top-stats': document.getElementById('total-show-top-stats').checked,
        'total-text-switch-enabled': document.getElementById('total-text-switch-enabled').checked,
        'total-text-switch-interval': document.getElementById('total-text-switch-interval').value,
        'total-title-size': document.getElementById('total-title-size').value,
        'total-stats-size': document.getElementById('total-stats-size').value,
        'total-progress-height': document.getElementById('total-progress-height').value
    };
    
    localStorage.setItem('graphSettings', JSON.stringify(localSettings));
    console.log('ğŸ’¾ ë¡œì»¬ ì„¤ì • ì €ì¥ë¨:', localSettings);
}

// ë¡œì»¬ ì„¤ì • ë¡œë“œ
function loadLocalSettings() {
    try {
        const saved = localStorage.getItem('graphSettings');
        if (saved) {
            const localSettings = JSON.parse(saved);
            console.log('ğŸ“‚ ë¡œì»¬ ì„¤ì • ë¡œë“œë¨:', localSettings);
            
            // í‡´ê·¼ë¯¸ì…˜ ê·¸ë˜í”„ ì„¤ì •
            if (localSettings['mission-bg-opacity']) document.getElementById('mission-bg-opacity').value = localSettings['mission-bg-opacity'];
            if (localSettings['mission-bg-color']) document.getElementById('mission-bg-color').value = localSettings['mission-bg-color'];
            if (localSettings['mission-text-outline-width']) document.getElementById('mission-text-outline-width').value = localSettings['mission-text-outline-width'];
            if (localSettings['mission-text-outline-color']) document.getElementById('mission-text-outline-color').value = localSettings['mission-text-outline-color'];
            if (localSettings['mission-title-size']) document.getElementById('mission-title-size').value = localSettings['mission-title-size'];
            if (localSettings['mission-stats-size']) document.getElementById('mission-stats-size').value = localSettings['mission-stats-size'];
            if (localSettings['mission-progress-height']) document.getElementById('mission-progress-height').value = localSettings['mission-progress-height'];
            if (localSettings['mission-show-progress-text'] !== undefined) document.getElementById('mission-show-progress-text').checked = localSettings['mission-show-progress-text'];
            if (localSettings['mission-progress-text-size']) document.getElementById('mission-progress-text-size').value = localSettings['mission-progress-text-size'];
            if (localSettings['mission-progress-text-color']) document.getElementById('mission-progress-text-color').value = localSettings['mission-progress-text-color'];
            
            // ì´ì•¡ëª©í‘œ ê·¸ë˜í”„ ì„¤ì •
            if (localSettings['daily-goal-target']) document.getElementById('daily-goal-target').value = localSettings['daily-goal-target'];
            if (localSettings['auto-extend-enabled'] !== undefined) document.getElementById('auto-extend-enabled').checked = localSettings['auto-extend-enabled'];
            if (localSettings['extend-amount']) document.getElementById('extend-amount').value = localSettings['extend-amount'];
            if (localSettings['total-bg-opacity']) document.getElementById('total-bg-opacity').value = localSettings['total-bg-opacity'];
            if (localSettings['total-bg-color']) document.getElementById('total-bg-color').value = localSettings['total-bg-color'];
            if (localSettings['total-text-outline-width']) document.getElementById('total-text-outline-width').value = localSettings['total-text-outline-width'];
            if (localSettings['total-text-outline-color']) document.getElementById('total-text-outline-color').value = localSettings['total-text-outline-color'];
            if (localSettings['total-show-top-stats'] !== undefined) document.getElementById('total-show-top-stats').checked = localSettings['total-show-top-stats'];
            if (localSettings['total-text-switch-enabled'] !== undefined) document.getElementById('total-text-switch-enabled').checked = localSettings['total-text-switch-enabled'];
            if (localSettings['total-text-switch-interval']) document.getElementById('total-text-switch-interval').value = localSettings['total-text-switch-interval'];
            if (localSettings['total-title-size']) document.getElementById('total-title-size').value = localSettings['total-title-size'];
            if (localSettings['total-stats-size']) document.getElementById('total-stats-size').value = localSettings['total-stats-size'];
            if (localSettings['total-progress-height']) document.getElementById('total-progress-height').value = localSettings['total-progress-height'];
            
            return true;
        }
    } catch (error) {
        console.error('ë¡œì»¬ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
    }
    return false;
}

// í˜„ì¬ ì„¤ì • ë¡œë“œ (ì„œë²„ ì„¤ì •ì„ ë°±ì—…ìœ¼ë¡œ ì‚¬ìš©)
async function loadCurrentSettings() {
    // ë¨¼ì € ë¡œì»¬ ì„¤ì •ì„ ì‹œë„
    const hasLocalSettings = loadLocalSettings();
    
    try {
        const response = await fetch('/api/data');
        const data = await response.json();
        const settings = data.settings || {};
        
        // ë¡œì»¬ ì„¤ì •ì´ ì—†ëŠ” ê²½ìš°ì—ë§Œ ì„œë²„ ì„¤ì • ì‚¬ìš©
        if (!hasLocalSettings) {
            // í‡´ê·¼ë¯¸ì…˜ ê·¸ë˜í”„ ì„¤ì •
            document.getElementById('mission-bg-opacity').value = settings['mission-graph-opacity'] || 85;
            document.getElementById('mission-bg-color').value = settings['mission-graph-bg-color'] || '#000000';
            document.getElementById('mission-text-outline-width').value = settings['mission-text-outline-width'] || 1;
            document.getElementById('mission-text-outline-color').value = settings['mission-text-outline-color'] || '#000000';
            document.getElementById('mission-title-size').value = parseInt(settings['mission-title-font-size']) || 20;
            document.getElementById('mission-stats-size').value = parseInt(settings['mission-stats-font-size']) || 16;
            document.getElementById('mission-progress-height').value = parseInt(settings['mission-progress-height']) || 20;
            document.getElementById('mission-show-progress-text').checked = settings['mission-show-progress-text'] !== false;
            document.getElementById('mission-progress-text-size').value = parseInt(settings['mission-progress-text-size']) || 12;
            document.getElementById('mission-progress-text-color').value = settings['mission-progress-text-color'] || '#ffffff';
        
            // ì´ì•¡ëª©í‘œ ê·¸ë˜í”„ ì„¤ì •
            if (settings.dailyGoal) {
                document.getElementById('daily-goal-target').value = settings.dailyGoal.target || '';
                document.getElementById('auto-extend-enabled').checked = settings.dailyGoal.autoExtendEnabled || settings.dailyGoal.autoExtend || false;
                document.getElementById('extend-amount').value = settings.dailyGoal.extendAmount || 50;
            }
            
            document.getElementById('total-bg-opacity').value = settings['total-goal-bg-opacity'] || 0;
            document.getElementById('total-bg-color').value = settings['total-goal-bg-color'] || '#000000';
            document.getElementById('total-text-outline-width').value = settings['total-goal-text-outline-width'] || 1;
            document.getElementById('total-text-outline-color').value = settings['total-goal-text-outline-color'] || '#000000';
            document.getElementById('total-show-top-stats').checked = settings['total-goal-show-top-stats'] !== false;
            document.getElementById('total-text-switch-enabled').checked = settings['total-goal-text-switch-enabled'] || false;
            document.getElementById('total-text-switch-interval').value = settings['total-goal-text-switch-interval'] || 5;
            document.getElementById('total-title-size').value = parseInt(settings['total-goal-title-font-size']) || 24;
            document.getElementById('total-stats-size').value = parseInt(settings['total-goal-stats-font-size']) || 20;
            document.getElementById('total-progress-height').value = parseInt(settings['total-goal-progress-height']) || 30;
        }
        
        // ìŠ¬ë¼ì´ë” ê°’ ì—…ë°ì´íŠ¸
        document.querySelectorAll('.slider').forEach(slider => updateSliderValue(slider));
        
        // ì²´í¬ë°•ìŠ¤ì— ë”°ë¥¸ ë¹„í™œì„±í™”
        document.getElementById('extend-amount').disabled = !document.getElementById('auto-extend-enabled').checked;
        document.getElementById('total-text-switch-interval').disabled = !document.getElementById('total-text-switch-enabled').checked;
        
        showStatus('âœ… í˜„ì¬ ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤', 'success');
    } catch (error) {
        console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
        showStatus('âŒ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤', 'error');
    }
}

// í‡´ê·¼ë¯¸ì…˜ ê·¸ë˜í”„ ì„¤ì • ì €ì¥
async function saveMissionSettings() {
    try {
        const settings = {
            'mission-graph-opacity': document.getElementById('mission-bg-opacity').value,
            'mission-graph-bg-color': document.getElementById('mission-bg-color').value,
            'mission-text-outline-width': document.getElementById('mission-text-outline-width').value,
            'mission-text-outline-color': document.getElementById('mission-text-outline-color').value,
            'mission-title-font-size': document.getElementById('mission-title-size').value,
            'mission-stats-font-size': document.getElementById('mission-stats-size').value,
            'mission-progress-height': document.getElementById('mission-progress-height').value,
            'mission-show-progress-text': document.getElementById('mission-show-progress-text').checked,
            'mission-progress-text-size': document.getElementById('mission-progress-text-size').value,
            'mission-progress-text-color': document.getElementById('mission-progress-text-color').value
        };
        
        const response = await fetch('/api/settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ settings })
        });
        
        const result = await response.json();
        if (result.success) {
            saveLocalSettings(); // ë¡œì»¬ì—ë„ ì €ì¥
            showStatus('âœ… í‡´ê·¼ë¯¸ì…˜ ê·¸ë˜í”„ ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        } else {
            showStatus('âŒ ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
        showStatus('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
    }
}

// ì´ì•¡ëª©í‘œ ê·¸ë˜í”„ ì„¤ì • ì €ì¥
async function saveTotalSettings() {
    try {
        const target = parseFloat(document.getElementById('daily-goal-target').value);
        if (!target || target <= 0) {
            showStatus('âš ï¸ ì˜¬ë°”ë¥¸ ëª©í‘œì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
            return;
        }
        
        const settings = {
            dailyGoal: {
                target: target,
                autoExtendEnabled: document.getElementById('auto-extend-enabled').checked,
                extendAmount: parseFloat(document.getElementById('extend-amount').value) || 50,
                createdDate: new Date().toISOString().split('T')[0]
            },
            'total-goal-bg-opacity': document.getElementById('total-bg-opacity').value,
            'total-goal-bg-color': document.getElementById('total-bg-color').value,
            'total-goal-text-outline-width': document.getElementById('total-text-outline-width').value,
            'total-goal-text-outline-color': document.getElementById('total-text-outline-color').value,
            'total-goal-show-top-stats': document.getElementById('total-show-top-stats').checked,
            'total-goal-text-switch-enabled': document.getElementById('total-text-switch-enabled').checked,
            'total-goal-text-switch-interval': document.getElementById('total-text-switch-interval').value,
            'total-goal-title-font-size': document.getElementById('total-title-size').value,
            'total-goal-stats-font-size': document.getElementById('total-stats-size').value,
            'total-goal-progress-height': document.getElementById('total-progress-height').value
        };
        
        const response = await fetch('/api/settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ settings })
        });
        
        const result = await response.json();
        if (result.success) {
            saveLocalSettings(); // ë¡œì»¬ì—ë„ ì €ì¥
            showStatus(`âœ… ì´ì•¡ëª©í‘œ ê·¸ë˜í”„ ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! (ëª©í‘œ: ${target}ë§Œì›)`, 'success');
        } else {
            showStatus('âŒ ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
        showStatus('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
    }
}

// ê¸°ë³¸ê°’ ì´ˆê¸°í™”
function resetMissionSettings() {
    if (confirm('ğŸ”„ í‡´ê·¼ë¯¸ì…˜ ê·¸ë˜í”„ ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        document.getElementById('mission-bg-opacity').value = 85;
        document.getElementById('mission-bg-color').value = '#000000';
        document.getElementById('mission-text-outline-width').value = 1;
        document.getElementById('mission-text-outline-color').value = '#000000';
        document.getElementById('mission-title-size').value = 20;
        document.getElementById('mission-stats-size').value = 16;
        document.getElementById('mission-progress-height').value = 20;
        document.getElementById('mission-show-progress-text').checked = true;
        document.getElementById('mission-progress-text-size').value = 12;
        document.getElementById('mission-progress-text-color').value = '#ffffff';
        
        document.querySelectorAll('.slider').forEach(slider => updateSliderValue(slider));
        saveLocalSettings(); // ì´ˆê¸°í™”ëœ ì„¤ì •ì„ ë¡œì»¬ì—ë„ ì €ì¥
        showStatus('ğŸ”„ í‡´ê·¼ë¯¸ì…˜ ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
    }
}

function resetTotalSettings() {
    if (confirm('ğŸ”„ ì´ì•¡ëª©í‘œ ê·¸ë˜í”„ ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        document.getElementById('daily-goal-target').value = '';
        document.getElementById('auto-extend-enabled').checked = false;
        document.getElementById('extend-amount').value = 50;
        document.getElementById('extend-amount').disabled = true;
        document.getElementById('total-bg-opacity').value = 0;
        document.getElementById('total-bg-color').value = '#000000';
        document.getElementById('total-text-outline-width').value = 1;
        document.getElementById('total-text-outline-color').value = '#000000';
        document.getElementById('total-show-top-stats').checked = true;
        document.getElementById('total-text-switch-enabled').checked = false;
        document.getElementById('total-text-switch-interval').value = 5;
        document.getElementById('total-text-switch-interval').disabled = true;
        document.getElementById('total-title-size').value = 24;
        document.getElementById('total-stats-size').value = 20;
        document.getElementById('total-progress-height').value = 30;
        
        document.querySelectorAll('.slider').forEach(slider => updateSliderValue(slider));
        saveLocalSettings(); // ì´ˆê¸°í™”ëœ ì„¤ì •ì„ ë¡œì»¬ì—ë„ ì €ì¥
        showStatus('ğŸ”„ ì´ì•¡ëª©í‘œ ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
    }
}

// ì˜¤ë²„ë ˆì´ ì—´ê¸°
function openMissionOverlay() {
    window.open('/mission-graph-overlay.html', '_blank', 'width=800,height=600');
}

function openTotalOverlay() {
    window.open('/total-goal-overlay.html', '_blank', 'width=800,height=600');
}

// ë¡œì»¬ ì„¤ì • ì´ˆê¸°í™”
function clearLocalSettings() {
    if (confirm('ğŸ—‘ï¸ ì €ì¥ëœ ë¡œì»¬ ì„¤ì •ì„ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në‹¤ìŒ ìƒˆë¡œê³ ì¹¨ ì‹œ ì„œë²„ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.')) {
        localStorage.removeItem('graphSettings');
        showStatus('ğŸ—‘ï¸ ë¡œì»¬ ì„¤ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.', 'success');
        
        // 3ì´ˆ í›„ ìë™ ìƒˆë¡œê³ ì¹¨
        setTimeout(() => {
            location.reload();
        }, 3000);
    }
}

// ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
function showStatus(message, type) {
    const statusDiv = document.getElementById('status-message');
    statusDiv.className = `status status-${type}`;
    statusDiv.textContent = message;
    statusDiv.style.display = 'block';
    
    setTimeout(() => {
        statusDiv.style.display = 'none';
    }, 3000);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
window.addEventListener('DOMContentLoaded', () => {
    initSocket();
    initSliders();
    console.log('ğŸ“Š ê·¸ë˜í”„ ì¡°ì •ëª¨ë“œ ì´ˆê¸°í™” ì™„ë£Œ');
});
</script>
</body>
</html>